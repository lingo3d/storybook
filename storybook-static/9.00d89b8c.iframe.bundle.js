(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"./node_modules/lingo3d/lib/display/core/SimpleObjectManager/PhysicsItem/enableBVHCamera.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var scene=__webpack_require__("./node_modules/lingo3d/lib/engine/scene/index.js"),useEditorActive=__webpack_require__("./node_modules/lingo3d/lib/states/useEditorActive.js"),reusables=__webpack_require__("./node_modules/lingo3d/lib/display/utils/reusables.js"),lib=__webpack_require__("./node_modules/@lincode/events/lib/index.js"),reactivity_lib=__webpack_require__("./node_modules/@lincode/reactivity/lib/index.js"),eventLoop=__webpack_require__("./node_modules/lingo3d/lib/engine/eventLoop.js"),useBVHMap=__webpack_require__("./node_modules/lingo3d/lib/states/useBVHMap.js");const bvhCameraSet=new Set,[emitBeforeCameraLoop,onBeforeCameraLoop]=Object(lib.b)();function setVisible(visible){var _a;const{target:target}=this;target&&void 0===target._visible&&(target.outerObject3d.visible=visible);for(const child of this.camera.children)void 0===(null===(_a=child.userData.manager)||void 0===_a?void 0:_a._visible)&&(child.visible=visible)}Object(reactivity_lib.b)((function(){const bvhArray=Object(useBVHMap.a)();if(!bvhArray.length){const handle=Object(eventLoop.a)(emitBeforeCameraLoop);return()=>{handle.cancel()}}const handle=Object(eventLoop.a)((()=>{emitBeforeCameraLoop();for(const cam of bvhCameraSet){const capsuleRadius=.5;cam.updateMatrixWorld();const direction=cam.getWorldDirection(reusables.l),{start:start,end:end}=reusables.d;end.copy(start.copy(cam.position)),reusables.a.makeEmpty(),reusables.a.expandByPoint(start),reusables.a.min.addScalar(-capsuleRadius),reusables.a.max.addScalar(capsuleRadius);const triPoint=reusables.i,capsulePoint=reusables.j;let distance=0,depth=0;for(const boundsTree of bvhArray)boundsTree.shapecast({intersectsBounds:box=>box.intersectsBox(reusables.a),intersectsTriangle:tri=>{distance=tri.closestPointToSegment(reusables.d,triPoint,capsulePoint),distance<capsuleRadius&&(depth=capsuleRadius-distance,start.addScaledVector(direction,depth),end.addScaledVector(direction,depth))}});const deltaVector=start.sub(cam.position),offset=Math.max(0,deltaVector.length()-1e-5);deltaVector.normalize().multiplyScalar(offset),cam.position.add(deltaVector)}}));return()=>{handle.cancel()}}),[useBVHMap.a]);__webpack_exports__.default=function(){if(this.done)return;const cam=this.camera;scene.a.attach(cam),bvhCameraSet.add(cam),this.then((()=>{scene.a.remove(cam),bvhCameraSet.delete(cam)}));let tooCloseOld=!1;this.watch(onBeforeCameraLoop((()=>{const origin=this.outerObject3d.getWorldPosition(reusables.i),camPos=this.object3d.getWorldPosition(reusables.j),dist=camPos.distanceTo(origin);cam.position.lerp(camPos,.1);const ratio=cam.position.distanceTo(origin)/dist;cam.position.lerpVectors(origin,camPos,ratio),cam.quaternion.copy(this.object3d.getWorldQuaternion(reusables.f));const tooClose=!Object(useEditorActive.a)()&&ratio<.35;tooClose!==tooCloseOld&&setVisible.call(this,!tooClose),tooCloseOld=tooClose})))}},"./node_modules/lingo3d/lib/states/useBVHMap.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"c",(function(){return pushBVHMap})),__webpack_require__.d(__webpack_exports__,"b",(function(){return pullBVHMap})),__webpack_require__.d(__webpack_exports__,"a",(function(){return getBVHMap}));var _lincode_reactivity__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@lincode/reactivity/lib/index.js");const[setBVHMap,getBVHMap]=Object(_lincode_reactivity__WEBPACK_IMPORTED_MODULE_0__.e)([]),pushBVHMap=Object(_lincode_reactivity__WEBPACK_IMPORTED_MODULE_0__.g)(setBVHMap,getBVHMap),pullBVHMap=Object(_lincode_reactivity__WEBPACK_IMPORTED_MODULE_0__.f)(setBVHMap,getBVHMap)}}]);