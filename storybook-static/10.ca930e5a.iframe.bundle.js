/*! For license information please see 10.ca930e5a.iframe.bundle.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"./node_modules/lingo3d/lib/display/utils/cloneSkinnedMesh.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__("./node_modules/three/build/three.module.js");function SkeletonUtils_clone(source){const sourceLookup=new Map,cloneLookup=new Map,clone=source.clone();return parallelTraverse(source,clone,(function(sourceNode,clonedNode){sourceLookup.set(clonedNode,sourceNode),cloneLookup.set(sourceNode,clonedNode)})),clone.traverse((function(node){if(!node.isSkinnedMesh)return;const clonedMesh=node,sourceMesh=sourceLookup.get(node),sourceBones=sourceMesh.skeleton.bones;clonedMesh.skeleton=sourceMesh.skeleton.clone(),clonedMesh.bindMatrix.copy(sourceMesh.bindMatrix),clonedMesh.skeleton.bones=sourceBones.map((function(bone){return cloneLookup.get(bone)})),clonedMesh.bind(clonedMesh.skeleton,clonedMesh.bindMatrix)})),clone}function parallelTraverse(a,b,callback){callback(a,b);for(let i=0;i<a.children.length;i++)parallelTraverse(a.children[i],b.children[i],callback)}__webpack_exports__.a=(target,animations=target.animations)=>{const clone=SkeletonUtils_clone(target);return clone.animations=animations,clone}},"./node_modules/lingo3d/lib/display/utils/loaders/loadFBX.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var fflate_module_namespaceObject={};__webpack_require__.r(fflate_module_namespaceObject),__webpack_require__.d(fflate_module_namespaceObject,"Deflate",(function(){return Deflate})),__webpack_require__.d(fflate_module_namespaceObject,"AsyncDeflate",(function(){return AsyncDeflate})),__webpack_require__.d(fflate_module_namespaceObject,"deflate",(function(){return deflate})),__webpack_require__.d(fflate_module_namespaceObject,"deflateSync",(function(){return deflateSync})),__webpack_require__.d(fflate_module_namespaceObject,"Inflate",(function(){return Inflate})),__webpack_require__.d(fflate_module_namespaceObject,"AsyncInflate",(function(){return AsyncInflate})),__webpack_require__.d(fflate_module_namespaceObject,"inflate",(function(){return inflate})),__webpack_require__.d(fflate_module_namespaceObject,"inflateSync",(function(){return inflateSync})),__webpack_require__.d(fflate_module_namespaceObject,"Gzip",(function(){return Gzip})),__webpack_require__.d(fflate_module_namespaceObject,"AsyncGzip",(function(){return AsyncGzip})),__webpack_require__.d(fflate_module_namespaceObject,"gzip",(function(){return gzip})),__webpack_require__.d(fflate_module_namespaceObject,"gzipSync",(function(){return gzipSync})),__webpack_require__.d(fflate_module_namespaceObject,"Gunzip",(function(){return Gunzip})),__webpack_require__.d(fflate_module_namespaceObject,"AsyncGunzip",(function(){return AsyncGunzip})),__webpack_require__.d(fflate_module_namespaceObject,"gunzip",(function(){return gunzip})),__webpack_require__.d(fflate_module_namespaceObject,"gunzipSync",(function(){return gunzipSync})),__webpack_require__.d(fflate_module_namespaceObject,"Zlib",(function(){return Zlib})),__webpack_require__.d(fflate_module_namespaceObject,"AsyncZlib",(function(){return AsyncZlib})),__webpack_require__.d(fflate_module_namespaceObject,"zlib",(function(){return zlib})),__webpack_require__.d(fflate_module_namespaceObject,"zlibSync",(function(){return zlibSync})),__webpack_require__.d(fflate_module_namespaceObject,"Unzlib",(function(){return Unzlib})),__webpack_require__.d(fflate_module_namespaceObject,"AsyncUnzlib",(function(){return AsyncUnzlib})),__webpack_require__.d(fflate_module_namespaceObject,"unzlib",(function(){return unzlib})),__webpack_require__.d(fflate_module_namespaceObject,"unzlibSync",(function(){return unzlibSync})),__webpack_require__.d(fflate_module_namespaceObject,"compress",(function(){return gzip})),__webpack_require__.d(fflate_module_namespaceObject,"AsyncCompress",(function(){return AsyncGzip})),__webpack_require__.d(fflate_module_namespaceObject,"compressSync",(function(){return gzipSync})),__webpack_require__.d(fflate_module_namespaceObject,"Compress",(function(){return Gzip})),__webpack_require__.d(fflate_module_namespaceObject,"Decompress",(function(){return Decompress})),__webpack_require__.d(fflate_module_namespaceObject,"AsyncDecompress",(function(){return AsyncDecompress})),__webpack_require__.d(fflate_module_namespaceObject,"decompress",(function(){return decompress})),__webpack_require__.d(fflate_module_namespaceObject,"decompressSync",(function(){return decompressSync})),__webpack_require__.d(fflate_module_namespaceObject,"DecodeUTF8",(function(){return DecodeUTF8})),__webpack_require__.d(fflate_module_namespaceObject,"EncodeUTF8",(function(){return EncodeUTF8})),__webpack_require__.d(fflate_module_namespaceObject,"strToU8",(function(){return strToU8})),__webpack_require__.d(fflate_module_namespaceObject,"strFromU8",(function(){return strFromU8})),__webpack_require__.d(fflate_module_namespaceObject,"ZipPassThrough",(function(){return ZipPassThrough})),__webpack_require__.d(fflate_module_namespaceObject,"ZipDeflate",(function(){return ZipDeflate})),__webpack_require__.d(fflate_module_namespaceObject,"AsyncZipDeflate",(function(){return AsyncZipDeflate})),__webpack_require__.d(fflate_module_namespaceObject,"Zip",(function(){return Zip})),__webpack_require__.d(fflate_module_namespaceObject,"zip",(function(){return zip})),__webpack_require__.d(fflate_module_namespaceObject,"zipSync",(function(){return zipSync})),__webpack_require__.d(fflate_module_namespaceObject,"UnzipPassThrough",(function(){return UnzipPassThrough})),__webpack_require__.d(fflate_module_namespaceObject,"UnzipInflate",(function(){return UnzipInflate})),__webpack_require__.d(fflate_module_namespaceObject,"AsyncUnzipInflate",(function(){return AsyncUnzipInflate})),__webpack_require__.d(fflate_module_namespaceObject,"Unzip",(function(){return Unzip})),__webpack_require__.d(fflate_module_namespaceObject,"unzip",(function(){return unzip})),__webpack_require__.d(fflate_module_namespaceObject,"unzipSync",(function(){return unzipSync}));var three_module=__webpack_require__("./node_modules/three/build/three.module.js"),ch2={},durl=function(c){return URL.createObjectURL(new Blob([c],{type:"text/javascript"}))},cwk=function(u){return new Worker(u)};try{URL.revokeObjectURL(durl(""))}catch(e){durl=function(c){return"data:application/javascript;charset=UTF-8,"+encodeURI(c)},cwk=function(u){return new Worker(u,{type:"module"})}}var u8=Uint8Array,u16=Uint16Array,u32=Uint32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(eb,start){for(var b=new u16(31),i=0;i<31;++i)b[i]=start+=1<<eb[i-1];var r=new u32(b[30]);for(i=1;i<30;++i)for(var j=b[i];j<b[i+1];++j)r[j]=j-b[i]<<5|i;return[b,r]},fflate_module_a=freb(fleb,2),fl=fflate_module_a[0],revfl=fflate_module_a[1];fl[28]=258,revfl[258]=28;for(var _b=freb(fdeb,0),fd=_b[0],revfd=_b[1],rev=new u16(32768),fflate_module_i=0;fflate_module_i<32768;++fflate_module_i){var x=(43690&fflate_module_i)>>>1|(21845&fflate_module_i)<<1;x=(61680&(x=(52428&x)>>>2|(13107&x)<<2))>>>4|(3855&x)<<4,rev[fflate_module_i]=((65280&x)>>>8|(255&x)<<8)>>>1}var hMap=function(cd,mb,r){for(var s=cd.length,i=0,l=new u16(mb);i<s;++i)++l[cd[i]-1];var co,le=new u16(mb);for(i=0;i<mb;++i)le[i]=le[i-1]+l[i-1]<<1;if(r){co=new u16(1<<mb);var rvb=15-mb;for(i=0;i<s;++i)if(cd[i])for(var sv=i<<4|cd[i],r_1=mb-cd[i],v=le[cd[i]-1]++<<r_1,m=v|(1<<r_1)-1;v<=m;++v)co[rev[v]>>>rvb]=sv}else for(co=new u16(s),i=0;i<s;++i)cd[i]&&(co[i]=rev[le[cd[i]-1]++]>>>15-cd[i]);return co},flt=new u8(288);for(fflate_module_i=0;fflate_module_i<144;++fflate_module_i)flt[fflate_module_i]=8;for(fflate_module_i=144;fflate_module_i<256;++fflate_module_i)flt[fflate_module_i]=9;for(fflate_module_i=256;fflate_module_i<280;++fflate_module_i)flt[fflate_module_i]=7;for(fflate_module_i=280;fflate_module_i<288;++fflate_module_i)flt[fflate_module_i]=8;var fdt=new u8(32);for(fflate_module_i=0;fflate_module_i<32;++fflate_module_i)fdt[fflate_module_i]=5;var flm=hMap(flt,9,0),flrm=hMap(flt,9,1),fdm=hMap(fdt,5,0),fdrm=hMap(fdt,5,1),max=function(a){for(var m=a[0],i=1;i<a.length;++i)a[i]>m&&(m=a[i]);return m},bits=function(d,p,m){var o=p/8|0;return(d[o]|d[o+1]<<8)>>(7&p)&m},bits16=function(d,p){var o=p/8|0;return(d[o]|d[o+1]<<8|d[o+2]<<16)>>(7&p)},shft=function(p){return(p/8|0)+(7&p&&1)},slc=function(v,s,e){(null==s||s<0)&&(s=0),(null==e||e>v.length)&&(e=v.length);var n=new(v instanceof u16?u16:v instanceof u32?u32:u8)(e-s);return n.set(v.subarray(s,e)),n},inflt=function(dat,buf,st){var sl=dat.length;if(!sl||st&&!st.l&&sl<5)return buf||new u8(0);var noBuf=!buf||st,noSt=!st||st.i;st||(st={}),buf||(buf=new u8(3*sl));var cbuf=function(l){var bl=buf.length;if(l>bl){var nbuf=new u8(Math.max(2*bl,l));nbuf.set(buf),buf=nbuf}},final=st.f||0,pos=st.p||0,bt=st.b||0,lm=st.l,dm=st.d,lbt=st.m,dbt=st.n,tbts=8*sl;do{if(!lm){st.f=final=bits(dat,pos,1);var type=bits(dat,pos+1,3);if(pos+=3,!type){var l=dat[(s=shft(pos)+4)-4]|dat[s-3]<<8,t=s+l;if(t>sl){if(noSt)throw"unexpected EOF";break}noBuf&&cbuf(bt+l),buf.set(dat.subarray(s,t),bt),st.b=bt+=l,st.p=pos=8*t;continue}if(1==type)lm=flrm,dm=fdrm,lbt=9,dbt=5;else{if(2!=type)throw"invalid block type";var hLit=bits(dat,pos,31)+257,hcLen=bits(dat,pos+10,15)+4,tl=hLit+bits(dat,pos+5,31)+1;pos+=14;for(var ldt=new u8(tl),clt=new u8(19),i=0;i<hcLen;++i)clt[clim[i]]=bits(dat,pos+3*i,7);pos+=3*hcLen;var clb=max(clt),clbmsk=(1<<clb)-1,clm=hMap(clt,clb,1);for(i=0;i<tl;){var s,r=clm[bits(dat,pos,clbmsk)];if(pos+=15&r,(s=r>>>4)<16)ldt[i++]=s;else{var c=0,n=0;for(16==s?(n=3+bits(dat,pos,3),pos+=2,c=ldt[i-1]):17==s?(n=3+bits(dat,pos,7),pos+=3):18==s&&(n=11+bits(dat,pos,127),pos+=7);n--;)ldt[i++]=c}}var lt=ldt.subarray(0,hLit),dt=ldt.subarray(hLit);lbt=max(lt),dbt=max(dt),lm=hMap(lt,lbt,1),dm=hMap(dt,dbt,1)}if(pos>tbts){if(noSt)throw"unexpected EOF";break}}noBuf&&cbuf(bt+131072);for(var lms=(1<<lbt)-1,dms=(1<<dbt)-1,lpos=pos;;lpos=pos){var sym=(c=lm[bits16(dat,pos)&lms])>>>4;if((pos+=15&c)>tbts){if(noSt)throw"unexpected EOF";break}if(!c)throw"invalid length/literal";if(sym<256)buf[bt++]=sym;else{if(256==sym){lpos=pos,lm=null;break}var add=sym-254;if(sym>264){var b=fleb[i=sym-257];add=bits(dat,pos,(1<<b)-1)+fl[i],pos+=b}var d=dm[bits16(dat,pos)&dms],dsym=d>>>4;if(!d)throw"invalid distance";pos+=15&d;dt=fd[dsym];if(dsym>3){b=fdeb[dsym];dt+=bits16(dat,pos)&(1<<b)-1,pos+=b}if(pos>tbts){if(noSt)throw"unexpected EOF";break}noBuf&&cbuf(bt+131072);for(var end=bt+add;bt<end;bt+=4)buf[bt]=buf[bt-dt],buf[bt+1]=buf[bt+1-dt],buf[bt+2]=buf[bt+2-dt],buf[bt+3]=buf[bt+3-dt];bt=end}}st.l=lm,st.p=lpos,st.b=bt,lm&&(final=1,st.m=lbt,st.d=dm,st.n=dbt)}while(!final);return bt==buf.length?buf:slc(buf,0,bt)},wbits=function(d,p,v){v<<=7&p;var o=p/8|0;d[o]|=v,d[o+1]|=v>>>8},wbits16=function(d,p,v){v<<=7&p;var o=p/8|0;d[o]|=v,d[o+1]|=v>>>8,d[o+2]|=v>>>16},hTree=function(d,mb){for(var t=[],i=0;i<d.length;++i)d[i]&&t.push({s:i,f:d[i]});var s=t.length,t2=t.slice();if(!s)return[et,0];if(1==s){var v=new u8(t[0].s+1);return v[t[0].s]=1,[v,1]}t.sort((function(a,b){return a.f-b.f})),t.push({s:-1,f:25001});var l=t[0],r=t[1],i0=0,i1=1,i2=2;for(t[0]={s:-1,f:l.f+r.f,l:l,r:r};i1!=s-1;)l=t[t[i0].f<t[i2].f?i0++:i2++],r=t[i0!=i1&&t[i0].f<t[i2].f?i0++:i2++],t[i1++]={s:-1,f:l.f+r.f,l:l,r:r};var maxSym=t2[0].s;for(i=1;i<s;++i)t2[i].s>maxSym&&(maxSym=t2[i].s);var tr=new u16(maxSym+1),mbt=ln(t[i1-1],tr,0);if(mbt>mb){i=0;var dt=0,lft=mbt-mb,cst=1<<lft;for(t2.sort((function(a,b){return tr[b.s]-tr[a.s]||a.f-b.f}));i<s;++i){var i2_1=t2[i].s;if(!(tr[i2_1]>mb))break;dt+=cst-(1<<mbt-tr[i2_1]),tr[i2_1]=mb}for(dt>>>=lft;dt>0;){var i2_2=t2[i].s;tr[i2_2]<mb?dt-=1<<mb-tr[i2_2]++-1:++i}for(;i>=0&&dt;--i){var i2_3=t2[i].s;tr[i2_3]==mb&&(--tr[i2_3],++dt)}mbt=mb}return[new u8(tr),mbt]},ln=function(n,l,d){return-1==n.s?Math.max(ln(n.l,l,d+1),ln(n.r,l,d+1)):l[n.s]=d},lc=function(c){for(var s=c.length;s&&!c[--s];);for(var cl=new u16(++s),cli=0,cln=c[0],cls=1,w=function(v){cl[cli++]=v},i=1;i<=s;++i)if(c[i]==cln&&i!=s)++cls;else{if(!cln&&cls>2){for(;cls>138;cls-=138)w(32754);cls>2&&(w(cls>10?cls-11<<5|28690:cls-3<<5|12305),cls=0)}else if(cls>3){for(w(cln),--cls;cls>6;cls-=6)w(8304);cls>2&&(w(cls-3<<5|8208),cls=0)}for(;cls--;)w(cln);cls=1,cln=c[i]}return[cl.subarray(0,cli),s]},clen=function(cf,cl){for(var l=0,i=0;i<cl.length;++i)l+=cf[i]*cl[i];return l},wfblk=function(out,pos,dat){var s=dat.length,o=shft(pos+2);out[o]=255&s,out[o+1]=s>>>8,out[o+2]=255^out[o],out[o+3]=255^out[o+1];for(var i=0;i<s;++i)out[o+i+4]=dat[i];return 8*(o+4+s)},wblk=function(dat,out,final,syms,lf,df,eb,li,bs,bl,p){wbits(out,p++,final),++lf[256];for(var _a=hTree(lf,15),dlt=_a[0],mlb=_a[1],_b=hTree(df,15),ddt=_b[0],mdb=_b[1],_c=lc(dlt),lclt=_c[0],nlc=_c[1],_d=lc(ddt),lcdt=_d[0],ndc=_d[1],lcfreq=new u16(19),i=0;i<lclt.length;++i)lcfreq[31&lclt[i]]++;for(i=0;i<lcdt.length;++i)lcfreq[31&lcdt[i]]++;for(var _e=hTree(lcfreq,7),lct=_e[0],mlcb=_e[1],nlcc=19;nlcc>4&&!lct[clim[nlcc-1]];--nlcc);var lm,ll,dm,dl,flen=bl+5<<3,ftlen=clen(lf,flt)+clen(df,fdt)+eb,dtlen=clen(lf,dlt)+clen(df,ddt)+eb+14+3*nlcc+clen(lcfreq,lct)+(2*lcfreq[16]+3*lcfreq[17]+7*lcfreq[18]);if(flen<=ftlen&&flen<=dtlen)return wfblk(out,p,dat.subarray(bs,bs+bl));if(wbits(out,p,1+(dtlen<ftlen)),p+=2,dtlen<ftlen){lm=hMap(dlt,mlb,0),ll=dlt,dm=hMap(ddt,mdb,0),dl=ddt;var llm=hMap(lct,mlcb,0);wbits(out,p,nlc-257),wbits(out,p+5,ndc-1),wbits(out,p+10,nlcc-4),p+=14;for(i=0;i<nlcc;++i)wbits(out,p+3*i,lct[clim[i]]);p+=3*nlcc;for(var lcts=[lclt,lcdt],it=0;it<2;++it){var clct=lcts[it];for(i=0;i<clct.length;++i){var len=31&clct[i];wbits(out,p,llm[len]),p+=lct[len],len>15&&(wbits(out,p,clct[i]>>>5&127),p+=clct[i]>>>12)}}}else lm=flm,ll=flt,dm=fdm,dl=fdt;for(i=0;i<li;++i)if(syms[i]>255){len=syms[i]>>>18&31;wbits16(out,p,lm[len+257]),p+=ll[len+257],len>7&&(wbits(out,p,syms[i]>>>23&31),p+=fleb[len]);var dst=31&syms[i];wbits16(out,p,dm[dst]),p+=dl[dst],dst>3&&(wbits16(out,p,syms[i]>>>5&8191),p+=fdeb[dst])}else wbits16(out,p,lm[syms[i]]),p+=ll[syms[i]];return wbits16(out,p,lm[256]),p+ll[256]},deo=new u32([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),et=new u8(0),dflt=function(dat,lvl,plvl,pre,post,lst){var s=dat.length,o=new u8(pre+s+5*(1+Math.ceil(s/7e3))+post),w=o.subarray(pre,o.length-post),pos=0;if(!lvl||s<8)for(var i=0;i<=s;i+=65535){var e=i+65535;e<s?pos=wfblk(w,pos,dat.subarray(i,e)):(w[i]=lst,pos=wfblk(w,pos,dat.subarray(i,s)))}else{for(var opt=deo[lvl-1],n=opt>>>13,c=8191&opt,msk_1=(1<<plvl)-1,prev=new u16(32768),head=new u16(msk_1+1),bs1_1=Math.ceil(plvl/3),bs2_1=2*bs1_1,hsh=function(i){return(dat[i]^dat[i+1]<<bs1_1^dat[i+2]<<bs2_1)&msk_1},syms=new u32(25e3),lf=new u16(288),df=new u16(32),lc_1=0,eb=0,li=(i=0,0),wi=0,bs=0;i<s;++i){var hv=hsh(i),imod=32767&i,pimod=head[hv];if(prev[imod]=pimod,head[hv]=imod,wi<=i){var rem=s-i;if((lc_1>7e3||li>24576)&&rem>423){pos=wblk(dat,w,0,syms,lf,df,eb,li,bs,i-bs,pos),li=lc_1=eb=0,bs=i;for(var j=0;j<286;++j)lf[j]=0;for(j=0;j<30;++j)df[j]=0}var l=2,d=0,ch_1=c,dif=imod-pimod&32767;if(rem>2&&hv==hsh(i-dif))for(var maxn=Math.min(n,rem)-1,maxd=Math.min(32767,i),ml=Math.min(258,rem);dif<=maxd&&--ch_1&&imod!=pimod;){if(dat[i+l]==dat[i+l-dif]){for(var nl=0;nl<ml&&dat[i+nl]==dat[i+nl-dif];++nl);if(nl>l){if(l=nl,d=dif,nl>maxn)break;var mmd=Math.min(dif,nl-2),md=0;for(j=0;j<mmd;++j){var ti=i-dif+j+32768&32767,cd=ti-prev[ti]+32768&32767;cd>md&&(md=cd,pimod=ti)}}}dif+=(imod=pimod)-(pimod=prev[imod])+32768&32767}if(d){syms[li++]=268435456|revfl[l]<<18|revfd[d];var lin=31&revfl[l],din=31&revfd[d];eb+=fleb[lin]+fdeb[din],++lf[257+lin],++df[din],wi=i+l,++lc_1}else syms[li++]=dat[i],++lf[dat[i]]}}pos=wblk(dat,w,lst,syms,lf,df,eb,li,bs,i-bs,pos),!lst&&7&pos&&(pos=wfblk(w,pos+1,et))}return slc(o,0,pre+shft(pos)+post)},crct=function(){for(var t=new u32(256),i=0;i<256;++i){for(var c=i,k=9;--k;)c=(1&c&&3988292384)^c>>>1;t[i]=c}return t}(),crc=function(){var c=-1;return{p:function(d){for(var cr=c,i=0;i<d.length;++i)cr=crct[255&cr^d[i]]^cr>>>8;c=cr},d:function(){return~c}}},adler=function(){var a=1,b=0;return{p:function(d){for(var n=a,m=b,l=d.length,i=0;i!=l;){for(var e=Math.min(i+2655,l);i<e;++i)m+=n+=d[i];n=(65535&n)+15*(n>>16),m=(65535&m)+15*(m>>16)}a=n,b=m},d:function(){return(255&(a%=65521))<<24|a>>>8<<16|(255&(b%=65521))<<8|b>>>8}}},dopt=function(dat,opt,pre,post,st){return dflt(dat,null==opt.level?6:opt.level,null==opt.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(dat.length)))):12+opt.mem,pre,post,!st)},mrg=function(a,b){var o={};for(var k in a)o[k]=a[k];for(var k in b)o[k]=b[k];return o},wcln=function(fn,fnStr,td){for(var dt=fn(),st=fn.toString(),ks=st.slice(st.indexOf("[")+1,st.lastIndexOf("]")).replace(/ /g,"").split(","),i=0;i<dt.length;++i){var v=dt[i],k=ks[i];if("function"==typeof v){fnStr+=";"+k+"=";var st_1=v.toString();if(v.prototype)if(-1!=st_1.indexOf("[native code]")){var spInd=st_1.indexOf(" ",8)+1;fnStr+=st_1.slice(spInd,st_1.indexOf("(",spInd))}else for(var t in fnStr+=st_1,v.prototype)fnStr+=";"+k+".prototype."+t+"="+v.prototype[t].toString();else fnStr+=st_1}else td[k]=v}return[fnStr,td]},ch=[],wrkr=function(fns,init,id,cb){var _a;if(!ch[id]){for(var fnStr="",td_1={},m=fns.length-1,i=0;i<m;++i)fnStr=(_a=wcln(fns[i],fnStr,td_1))[0],td_1=_a[1];ch[id]=wcln(fns[m],fnStr,td_1)}var td=mrg({},ch[id][1]);return function(c,id,msg,transfer,cb){var w=cwk(ch2[id]||(ch2[id]=durl(c)));return w.onerror=function(e){return cb(e.error,null)},w.onmessage=function(e){return cb(null,e.data)},w.postMessage(msg,transfer),w}(ch[id][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+init.toString()+"}",id,td,function(v){var tl=[];for(var k in v)(v[k]instanceof u8||v[k]instanceof u16||v[k]instanceof u32)&&tl.push((v[k]=new v[k].constructor(v[k])).buffer);return tl}(td),cb)},bInflt=function(){return[u8,u16,u32,fleb,fdeb,clim,fl,fd,flrm,fdrm,rev,hMap,max,bits,bits16,shft,slc,inflt,inflateSync,pbf,gu8]},bDflt=function(){return[u8,u16,u32,fleb,fdeb,clim,revfl,revfd,flm,flt,fdm,fdt,rev,deo,et,hMap,wbits,wbits16,hTree,ln,lc,clen,wfblk,wblk,shft,slc,dflt,dopt,deflateSync,pbf]},gze=function(){return[gzh,gzhl,wbytes,crc,crct]},guze=function(){return[gzs,gzl]},zle=function(){return[zlh,wbytes,adler]},zule=function(){return[zlv]},pbf=function(msg){return postMessage(msg,[msg.buffer])},gu8=function(o){return o&&o.size&&new u8(o.size)},cbify=function(dat,opts,fns,init,id,cb){var w=wrkr(fns,init,id,(function(err,dat){w.terminate(),cb(err,dat)}));return w.postMessage([dat,opts],opts.consume?[dat.buffer]:[]),function(){w.terminate()}},astrm=function(strm){return strm.ondata=function(dat,final){return postMessage([dat,final],[dat.buffer])},function(ev){return strm.push(ev.data[0],ev.data[1])}},astrmify=function(fns,strm,opts,init,id){var t,w=wrkr(fns,init,id,(function(err,dat){err?(w.terminate(),strm.ondata.call(strm,err)):(dat[1]&&w.terminate(),strm.ondata.call(strm,err,dat[0],dat[1]))}));w.postMessage(opts),strm.push=function(d,f){if(t)throw"stream finished";if(!strm.ondata)throw"no stream handler";w.postMessage([d,t=f],[d.buffer])},strm.terminate=function(){w.terminate()}},b2=function(d,b){return d[b]|d[b+1]<<8},b4=function(d,b){return(d[b]|d[b+1]<<8|d[b+2]<<16|d[b+3]<<24)>>>0},b8=function(d,b){return b4(d,b)+4294967296*b4(d,b+4)},wbytes=function(d,b,v){for(;v;++b)d[b]=v,v>>>=8},gzh=function(c,o){var fn=o.filename;if(c[0]=31,c[1]=139,c[2]=8,c[8]=o.level<2?4:9==o.level?2:0,c[9]=3,0!=o.mtime&&wbytes(c,4,Math.floor(new Date(o.mtime||Date.now())/1e3)),fn){c[3]=8;for(var i=0;i<=fn.length;++i)c[i+10]=fn.charCodeAt(i)}},gzs=function(d){if(31!=d[0]||139!=d[1]||8!=d[2])throw"invalid gzip data";var flg=d[3],st=10;4&flg&&(st+=d[10]|2+(d[11]<<8));for(var zs=(flg>>3&1)+(flg>>4&1);zs>0;zs-=!d[st++]);return st+(2&flg)},gzl=function(d){var l=d.length;return(d[l-4]|d[l-3]<<8|d[l-2]<<16|d[l-1]<<24)>>>0},gzhl=function(o){return 10+(o.filename&&o.filename.length+1||0)},zlh=function(c,o){var lv=o.level,fl=0==lv?0:lv<6?1:9==lv?3:2;c[0]=120,c[1]=fl<<6|(fl?32-2*fl:1)},zlv=function(d){if(8!=(15&d[0])||d[0]>>>4>7||(d[0]<<8|d[1])%31)throw"invalid zlib data";if(32&d[1])throw"invalid zlib data: preset dictionaries not supported"};function AsyncCmpStrm(opts,cb){return cb||"function"!=typeof opts||(cb=opts,opts={}),this.ondata=cb,opts}var Deflate=function(){function Deflate(opts,cb){cb||"function"!=typeof opts||(cb=opts,opts={}),this.ondata=cb,this.o=opts||{}}return Deflate.prototype.p=function(c,f){this.ondata(dopt(c,this.o,0,0,!f),f)},Deflate.prototype.push=function(chunk,final){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=final,this.p(chunk,final||!1)},Deflate}(),AsyncDeflate=function(){return function AsyncDeflate(opts,cb){astrmify([bDflt,function(){return[astrm,Deflate]}],this,AsyncCmpStrm.call(this,opts,cb),(function(ev){var strm=new Deflate(ev.data);onmessage=astrm(strm)}),6)}}();function deflate(data,opts,cb){if(cb||(cb=opts,opts={}),"function"!=typeof cb)throw"no callback";return cbify(data,opts,[bDflt],(function(ev){return pbf(deflateSync(ev.data[0],ev.data[1]))}),0,cb)}function deflateSync(data,opts){return dopt(data,opts||{},0,0)}var Inflate=function(){function Inflate(cb){this.s={},this.p=new u8(0),this.ondata=cb}return Inflate.prototype.e=function(c){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var l=this.p.length,n=new u8(l+c.length);n.set(this.p),n.set(c,l),this.p=n},Inflate.prototype.c=function(final){this.d=this.s.i=final||!1;var bts=this.s.b,dt=inflt(this.p,this.o,this.s);this.ondata(slc(dt,bts,this.s.b),this.d),this.o=slc(dt,this.s.b-32768),this.s.b=this.o.length,this.p=slc(this.p,this.s.p/8|0),this.s.p&=7},Inflate.prototype.push=function(chunk,final){this.e(chunk),this.c(final)},Inflate}(),AsyncInflate=function(){return function AsyncInflate(cb){this.ondata=cb,astrmify([bInflt,function(){return[astrm,Inflate]}],this,0,(function(){var strm=new Inflate;onmessage=astrm(strm)}),7)}}();function inflate(data,opts,cb){if(cb||(cb=opts,opts={}),"function"!=typeof cb)throw"no callback";return cbify(data,opts,[bInflt],(function(ev){return pbf(inflateSync(ev.data[0],gu8(ev.data[1])))}),1,cb)}function inflateSync(data,out){return inflt(data,out)}var Gzip=function(){function Gzip(opts,cb){this.c=crc(),this.l=0,this.v=1,Deflate.call(this,opts,cb)}return Gzip.prototype.push=function(chunk,final){Deflate.prototype.push.call(this,chunk,final)},Gzip.prototype.p=function(c,f){this.c.p(c),this.l+=c.length;var raw=dopt(c,this.o,this.v&&gzhl(this.o),f&&8,!f);this.v&&(gzh(raw,this.o),this.v=0),f&&(wbytes(raw,raw.length-8,this.c.d()),wbytes(raw,raw.length-4,this.l)),this.ondata(raw,f)},Gzip}(),AsyncGzip=function(){return function AsyncGzip(opts,cb){astrmify([bDflt,gze,function(){return[astrm,Deflate,Gzip]}],this,AsyncCmpStrm.call(this,opts,cb),(function(ev){var strm=new Gzip(ev.data);onmessage=astrm(strm)}),8)}}();function gzip(data,opts,cb){if(cb||(cb=opts,opts={}),"function"!=typeof cb)throw"no callback";return cbify(data,opts,[bDflt,gze,function(){return[gzipSync]}],(function(ev){return pbf(gzipSync(ev.data[0],ev.data[1]))}),2,cb)}function gzipSync(data,opts){opts||(opts={});var c=crc(),l=data.length;c.p(data);var d=dopt(data,opts,gzhl(opts),8),s=d.length;return gzh(d,opts),wbytes(d,s-8,c.d()),wbytes(d,s-4,l),d}var Gunzip=function(){function Gunzip(cb){this.v=1,Inflate.call(this,cb)}return Gunzip.prototype.push=function(chunk,final){if(Inflate.prototype.e.call(this,chunk),this.v){var s=this.p.length>3?gzs(this.p):4;if(s>=this.p.length&&!final)return;this.p=this.p.subarray(s),this.v=0}if(final){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Inflate.prototype.c.call(this,final)},Gunzip}(),AsyncGunzip=function(){return function AsyncGunzip(cb){this.ondata=cb,astrmify([bInflt,guze,function(){return[astrm,Inflate,Gunzip]}],this,0,(function(){var strm=new Gunzip;onmessage=astrm(strm)}),9)}}();function gunzip(data,opts,cb){if(cb||(cb=opts,opts={}),"function"!=typeof cb)throw"no callback";return cbify(data,opts,[bInflt,guze,function(){return[gunzipSync]}],(function(ev){return pbf(gunzipSync(ev.data[0]))}),3,cb)}function gunzipSync(data,out){return inflt(data.subarray(gzs(data),-8),out||new u8(gzl(data)))}var Zlib=function(){function Zlib(opts,cb){this.c=adler(),this.v=1,Deflate.call(this,opts,cb)}return Zlib.prototype.push=function(chunk,final){Deflate.prototype.push.call(this,chunk,final)},Zlib.prototype.p=function(c,f){this.c.p(c);var raw=dopt(c,this.o,this.v&&2,f&&4,!f);this.v&&(zlh(raw,this.o),this.v=0),f&&wbytes(raw,raw.length-4,this.c.d()),this.ondata(raw,f)},Zlib}(),AsyncZlib=function(){return function AsyncZlib(opts,cb){astrmify([bDflt,zle,function(){return[astrm,Deflate,Zlib]}],this,AsyncCmpStrm.call(this,opts,cb),(function(ev){var strm=new Zlib(ev.data);onmessage=astrm(strm)}),10)}}();function zlib(data,opts,cb){if(cb||(cb=opts,opts={}),"function"!=typeof cb)throw"no callback";return cbify(data,opts,[bDflt,zle,function(){return[zlibSync]}],(function(ev){return pbf(zlibSync(ev.data[0],ev.data[1]))}),4,cb)}function zlibSync(data,opts){opts||(opts={});var a=adler();a.p(data);var d=dopt(data,opts,2,4);return zlh(d,opts),wbytes(d,d.length-4,a.d()),d}var Unzlib=function(){function Unzlib(cb){this.v=1,Inflate.call(this,cb)}return Unzlib.prototype.push=function(chunk,final){if(Inflate.prototype.e.call(this,chunk),this.v){if(this.p.length<2&&!final)return;this.p=this.p.subarray(2),this.v=0}if(final){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Inflate.prototype.c.call(this,final)},Unzlib}(),AsyncUnzlib=function(){return function AsyncUnzlib(cb){this.ondata=cb,astrmify([bInflt,zule,function(){return[astrm,Inflate,Unzlib]}],this,0,(function(){var strm=new Unzlib;onmessage=astrm(strm)}),11)}}();function unzlib(data,opts,cb){if(cb||(cb=opts,opts={}),"function"!=typeof cb)throw"no callback";return cbify(data,opts,[bInflt,zule,function(){return[unzlibSync]}],(function(ev){return pbf(unzlibSync(ev.data[0],gu8(ev.data[1])))}),5,cb)}function unzlibSync(data,out){return inflt((zlv(data),data.subarray(2,-4)),out)}var Decompress=function(){function Decompress(cb){this.G=Gunzip,this.I=Inflate,this.Z=Unzlib,this.ondata=cb}return Decompress.prototype.push=function(chunk,final){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(chunk,final);else{if(this.p&&this.p.length){var n=new u8(this.p.length+chunk.length);n.set(this.p),n.set(chunk,this.p.length)}else this.p=chunk;if(this.p.length>2){var _this_1=this,cb=function(){_this_1.ondata.apply(_this_1,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(cb):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(cb):new this.Z(cb),this.s.push(this.p,final),this.p=null}}},Decompress}(),AsyncDecompress=function(){function AsyncDecompress(cb){this.G=AsyncGunzip,this.I=AsyncInflate,this.Z=AsyncUnzlib,this.ondata=cb}return AsyncDecompress.prototype.push=function(chunk,final){Decompress.prototype.push.call(this,chunk,final)},AsyncDecompress}();function decompress(data,opts,cb){if(cb||(cb=opts,opts={}),"function"!=typeof cb)throw"no callback";return 31==data[0]&&139==data[1]&&8==data[2]?gunzip(data,opts,cb):8!=(15&data[0])||data[0]>>4>7||(data[0]<<8|data[1])%31?inflate(data,opts,cb):unzlib(data,opts,cb)}function decompressSync(data,out){return 31==data[0]&&139==data[1]&&8==data[2]?gunzipSync(data,out):8!=(15&data[0])||data[0]>>4>7||(data[0]<<8|data[1])%31?inflateSync(data,out):unzlibSync(data,out)}var fltn=function(d,p,t,o){for(var k in d){var val=d[k],n=p+k;val instanceof u8?t[n]=[val,o]:Array.isArray(val)?t[n]=[val[0],mrg(o,val[1])]:fltn(val,n+"/",t,o)}},te="undefined"!=typeof TextEncoder&&new TextEncoder,td="undefined"!=typeof TextDecoder&&new TextDecoder,tds=0;try{td.decode(et,{stream:!0}),tds=1}catch(e){}var dutf8=function(d){for(var r="",i=0;;){var c=d[i++],eb=(c>127)+(c>223)+(c>239);if(i+eb>d.length)return[r,slc(d,i-1)];eb?3==eb?(c=((15&c)<<18|(63&d[i++])<<12|(63&d[i++])<<6|63&d[i++])-65536,r+=String.fromCharCode(55296|c>>10,56320|1023&c)):r+=1&eb?String.fromCharCode((31&c)<<6|63&d[i++]):String.fromCharCode((15&c)<<12|(63&d[i++])<<6|63&d[i++]):r+=String.fromCharCode(c)}},DecodeUTF8=function(){function DecodeUTF8(cb){this.ondata=cb,tds?this.t=new TextDecoder:this.p=et}return DecodeUTF8.prototype.push=function(chunk,final){if(!this.ondata)throw"no callback";if(final=!!final,this.t){if(this.ondata(this.t.decode(chunk,{stream:!0}),final),final){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var dat=new u8(this.p.length+chunk.length);dat.set(this.p),dat.set(chunk,this.p.length);var _a=dutf8(dat),ch=_a[0],np=_a[1];if(final){if(np.length)throw"invalid utf-8 data";this.p=null}else this.p=np;this.ondata(ch,final)}},DecodeUTF8}(),EncodeUTF8=function(){function EncodeUTF8(cb){this.ondata=cb}return EncodeUTF8.prototype.push=function(chunk,final){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(strToU8(chunk),this.d=final||!1)},EncodeUTF8}();function strToU8(str,latin1){if(latin1){for(var ar_1=new u8(str.length),i=0;i<str.length;++i)ar_1[i]=str.charCodeAt(i);return ar_1}if(te)return te.encode(str);var l=str.length,ar=new u8(str.length+(str.length>>1)),ai=0,w=function(v){ar[ai++]=v};for(i=0;i<l;++i){if(ai+5>ar.length){var n=new u8(ai+8+(l-i<<1));n.set(ar),ar=n}var c=str.charCodeAt(i);c<128||latin1?w(c):c<2048?(w(192|c>>6),w(128|63&c)):c>55295&&c<57344?(w(240|(c=65536+(1047552&c)|1023&str.charCodeAt(++i))>>18),w(128|c>>12&63),w(128|c>>6&63),w(128|63&c)):(w(224|c>>12),w(128|c>>6&63),w(128|63&c))}return slc(ar,0,ai)}function strFromU8(dat,latin1){if(latin1){for(var r="",i=0;i<dat.length;i+=16384)r+=String.fromCharCode.apply(null,dat.subarray(i,i+16384));return r}if(td)return td.decode(dat);var _a=dutf8(dat),out=_a[0];if(_a[1].length)throw"invalid utf-8 data";return out}var dbf=function(l){return 1==l?3:l<6?2:9==l?1:0},slzh=function(d,b){return b+30+b2(d,b+26)+b2(d,b+28)},zh=function(d,b,z){var fnl=b2(d,b+28),fn=strFromU8(d.subarray(b+46,b+46+fnl),!(2048&b2(d,b+8))),es=b+46+fnl,bs=b4(d,b+20),_a=z&&4294967295==bs?z64e(d,es):[bs,b4(d,b+24),b4(d,b+42)],sc=_a[0],su=_a[1],off=_a[2];return[b2(d,b+10),sc,su,fn,es+b2(d,b+30)+b2(d,b+32),off]},z64e=function(d,b){for(;1!=b2(d,b);b+=4+b2(d,b+2));return[b8(d,b+12),b8(d,b+4),b8(d,b+20)]},exfl=function(ex){var le=0;if(ex)for(var k in ex){var l=ex[k].length;if(l>65535)throw"extra field too long";le+=l+4}return le},wzh=function(d,b,f,fn,u,c,ce,co){var fl=fn.length,ex=f.extra,col=co&&co.length,exl=exfl(ex);wbytes(d,b,null!=ce?33639248:67324752),b+=4,null!=ce&&(d[b++]=20,d[b++]=f.os),d[b]=20,b+=2,d[b++]=f.flag<<1|(null==c&&8),d[b++]=u&&8,d[b++]=255&f.compression,d[b++]=f.compression>>8;var dt=new Date(null==f.mtime?Date.now():f.mtime),y=dt.getFullYear()-1980;if(y<0||y>119)throw"date not in range 1980-2099";if(wbytes(d,b,y<<25|dt.getMonth()+1<<21|dt.getDate()<<16|dt.getHours()<<11|dt.getMinutes()<<5|dt.getSeconds()>>>1),b+=4,null!=c&&(wbytes(d,b,f.crc),wbytes(d,b+4,c),wbytes(d,b+8,f.size)),wbytes(d,b+12,fl),wbytes(d,b+14,exl),b+=16,null!=ce&&(wbytes(d,b,col),wbytes(d,b+6,f.attrs),wbytes(d,b+10,ce),b+=14),d.set(fn,b),b+=fl,exl)for(var k in ex){var exf=ex[k],l=exf.length;wbytes(d,b,+k),wbytes(d,b+2,l),d.set(exf,b+4),b+=4+l}return col&&(d.set(co,b),b+=col),b},wzf=function(o,b,c,d,e){wbytes(o,b,101010256),wbytes(o,b+8,c),wbytes(o,b+10,c),wbytes(o,b+12,d),wbytes(o,b+16,e)},ZipPassThrough=function(){function ZipPassThrough(filename){this.filename=filename,this.c=crc(),this.size=0,this.compression=0}return ZipPassThrough.prototype.process=function(chunk,final){this.ondata(null,chunk,final)},ZipPassThrough.prototype.push=function(chunk,final){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(chunk),this.size+=chunk.length,final&&(this.crc=this.c.d()),this.process(chunk,final||!1)},ZipPassThrough}(),ZipDeflate=function(){function ZipDeflate(filename,opts){var _this_1=this;opts||(opts={}),ZipPassThrough.call(this,filename),this.d=new Deflate(opts,(function(dat,final){_this_1.ondata(null,dat,final)})),this.compression=8,this.flag=dbf(opts.level)}return ZipDeflate.prototype.process=function(chunk,final){try{this.d.push(chunk,final)}catch(e){this.ondata(e,null,final)}},ZipDeflate.prototype.push=function(chunk,final){ZipPassThrough.prototype.push.call(this,chunk,final)},ZipDeflate}(),AsyncZipDeflate=function(){function AsyncZipDeflate(filename,opts){var _this_1=this;opts||(opts={}),ZipPassThrough.call(this,filename),this.d=new AsyncDeflate(opts,(function(err,dat,final){_this_1.ondata(err,dat,final)})),this.compression=8,this.flag=dbf(opts.level),this.terminate=this.d.terminate}return AsyncZipDeflate.prototype.process=function(chunk,final){this.d.push(chunk,final)},AsyncZipDeflate.prototype.push=function(chunk,final){ZipPassThrough.prototype.push.call(this,chunk,final)},AsyncZipDeflate}(),Zip=function(){function Zip(cb){this.ondata=cb,this.u=[],this.d=1}return Zip.prototype.add=function(file){var _this_1=this;if(2&this.d)throw"stream finished";var f=strToU8(file.filename),fl=f.length,com=file.comment,o=com&&strToU8(com),u=fl!=file.filename.length||o&&com.length!=o.length,hl=fl+exfl(file.extra)+30;if(fl>65535)throw"filename too long";var header=new u8(hl);wzh(header,0,file,f,u);var chks=[header],pAll=function(){for(var _i=0,chks_1=chks;_i<chks_1.length;_i++){var chk=chks_1[_i];_this_1.ondata(null,chk,!1)}chks=[]},tr=this.d;this.d=0;var ind=this.u.length,uf=mrg(file,{f:f,u:u,o:o,t:function(){file.terminate&&file.terminate()},r:function(){if(pAll(),tr){var nxt=_this_1.u[ind+1];nxt?nxt.r():_this_1.d=1}tr=1}}),cl=0;file.ondata=function(err,dat,final){if(err)_this_1.ondata(err,dat,final),_this_1.terminate();else if(cl+=dat.length,chks.push(dat),final){var dd=new u8(16);wbytes(dd,0,134695760),wbytes(dd,4,file.crc),wbytes(dd,8,cl),wbytes(dd,12,file.size),chks.push(dd),uf.c=cl,uf.b=hl+cl+16,uf.crc=file.crc,uf.size=file.size,tr&&uf.r(),tr=1}else tr&&pAll()},this.u.push(uf)},Zip.prototype.end=function(){var _this_1=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&_this_1.d&&(_this_1.u.splice(-1,1),_this_1.e())},t:function(){}}),this.d=3},Zip.prototype.e=function(){for(var bt=0,l=0,tl=0,_i=0,_a=this.u;_i<_a.length;_i++){tl+=46+(f=_a[_i]).f.length+exfl(f.extra)+(f.o?f.o.length:0)}for(var out=new u8(tl+22),_b=0,_c=this.u;_b<_c.length;_b++){var f=_c[_b];wzh(out,bt,f,f.f,f.u,f.c,l,f.o),bt+=46+f.f.length+exfl(f.extra)+(f.o?f.o.length:0),l+=f.b}wzf(out,bt,this.u.length,tl,l),this.ondata(null,out,!0),this.d=2},Zip.prototype.terminate=function(){for(var _i=0,_a=this.u;_i<_a.length;_i++){_a[_i].t()}this.d=2},Zip}();function zip(data,opts,cb){if(cb||(cb=opts,opts={}),"function"!=typeof cb)throw"no callback";var r={};fltn(data,"",r,opts);var k=Object.keys(r),lft=k.length,o=0,tot=0,slft=lft,files=new Array(lft),term=[],tAll=function(){for(var i=0;i<term.length;++i)term[i]()},cbf=function(){var out=new u8(tot+22),oe=o,cdl=tot-o;tot=0;for(var i=0;i<slft;++i){var f=files[i];try{var l=f.c.length;wzh(out,tot,f,f.f,f.u,l);var badd=30+f.f.length+exfl(f.extra),loc=tot+badd;out.set(f.c,loc),wzh(out,o,f,f.f,f.u,l,tot,f.m),o+=16+badd+(f.m?f.m.length:0),tot=loc+l}catch(e){return cb(e,null)}}wzf(out,o,files.length,cdl,oe),cb(null,out)};lft||cbf();for(var _loop_1=function(i){var fn=k[i],_a=r[fn],file=_a[0],p=_a[1],c=crc(),size=file.length;c.p(file);var f=strToU8(fn),s=f.length,com=p.comment,m=com&&strToU8(com),ms=m&&m.length,exl=exfl(p.extra),compression=0==p.level?0:8,cbl=function(e,d){if(e)tAll(),cb(e,null);else{var l=d.length;files[i]=mrg(p,{size:size,crc:c.d(),c:d,f:f,m:m,u:s!=fn.length||m&&com.length!=ms,compression:compression}),o+=30+s+exl+l,tot+=76+2*(s+exl)+(ms||0)+l,--lft||cbf()}};if(s>65535&&cbl("filename too long",null),compression)if(size<16e4)try{cbl(null,deflateSync(file,p))}catch(e){cbl(e,null)}else term.push(deflate(file,p,cbl));else cbl(null,file)},i=0;i<slft;++i)_loop_1(i);return tAll}function zipSync(data,opts){opts||(opts={});var r={},files=[];fltn(data,"",r,opts);var o=0,tot=0;for(var fn in r){var _a=r[fn],file=_a[0],p=_a[1],compression=0==p.level?0:8,s=(f=strToU8(fn)).length,com=p.comment,m=com&&strToU8(com),ms=m&&m.length,exl=exfl(p.extra);if(s>65535)throw"filename too long";var d=compression?deflateSync(file,p):file,l=d.length,c=crc();c.p(file),files.push(mrg(p,{size:file.length,crc:c.d(),c:d,f:f,m:m,u:s!=fn.length||m&&com.length!=ms,o:o,compression:compression})),o+=30+s+exl+l,tot+=76+2*(s+exl)+(ms||0)+l}for(var out=new u8(tot+22),oe=o,cdl=tot-o,i=0;i<files.length;++i){var f=files[i];wzh(out,f.o,f,f.f,f.u,f.c.length);var badd=30+f.f.length+exfl(f.extra);out.set(f.c,f.o+badd),wzh(out,o,f,f.f,f.u,f.c.length,f.o,f.m),o+=16+badd+(f.m?f.m.length:0)}return wzf(out,o,files.length,cdl,oe),out}var UnzipPassThrough=function(){function UnzipPassThrough(){}return UnzipPassThrough.prototype.push=function(data,final){this.ondata(null,data,final)},UnzipPassThrough.compression=0,UnzipPassThrough}(),UnzipInflate=function(){function UnzipInflate(){var _this_1=this;this.i=new Inflate((function(dat,final){_this_1.ondata(null,dat,final)}))}return UnzipInflate.prototype.push=function(data,final){try{this.i.push(data,final)}catch(e){this.ondata(e,data,final)}},UnzipInflate.compression=8,UnzipInflate}(),AsyncUnzipInflate=function(){function AsyncUnzipInflate(_,sz){var _this_1=this;sz<32e4?this.i=new Inflate((function(dat,final){_this_1.ondata(null,dat,final)})):(this.i=new AsyncInflate((function(err,dat,final){_this_1.ondata(err,dat,final)})),this.terminate=this.i.terminate)}return AsyncUnzipInflate.prototype.push=function(data,final){this.i.terminate&&(data=slc(data,0)),this.i.push(data,final)},AsyncUnzipInflate.compression=8,AsyncUnzipInflate}(),Unzip=function(){function Unzip(cb){this.onfile=cb,this.k=[],this.o={0:UnzipPassThrough},this.p=et}return Unzip.prototype.push=function(chunk,final){var _this_1=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var len=Math.min(this.c,chunk.length),toAdd=chunk.subarray(0,len);if(this.c-=len,this.d?this.d.push(toAdd,!this.c):this.k[0].push(toAdd),(chunk=chunk.subarray(len)).length)return this.push(chunk,final)}else{var f=0,i=0,is=void 0,buf=void 0;this.p.length?chunk.length?((buf=new u8(this.p.length+chunk.length)).set(this.p),buf.set(chunk,this.p.length)):buf=this.p:buf=chunk;for(var l=buf.length,oc=this.c,add=oc&&this.d,_loop_2=function(){var _a,sig=b4(buf,i);if(67324752==sig){f=1,is=i,this_1.d=null,this_1.c=0;var bf=b2(buf,i+6),cmp_1=b2(buf,i+8),u=2048&bf,dd=8&bf,fnl=b2(buf,i+26),es=b2(buf,i+28);if(l>i+30+fnl+es){var chks_2=[];this_1.k.unshift(chks_2),f=2;var d_1,sc_1=b4(buf,i+18),su_1=b4(buf,i+22),fn_1=strFromU8(buf.subarray(i+30,i+=30+fnl),!u);4294967295==sc_1?(_a=dd?[-2]:z64e(buf,i),sc_1=_a[0],su_1=_a[1]):dd&&(sc_1=-1),i+=es,this_1.c=sc_1;var file_1={name:fn_1,compression:cmp_1,start:function(){if(!file_1.ondata)throw"no callback";if(sc_1){var ctr=_this_1.o[cmp_1];if(!ctr)throw"unknown compression type "+cmp_1;(d_1=sc_1<0?new ctr(fn_1):new ctr(fn_1,sc_1,su_1)).ondata=function(err,dat,final){file_1.ondata(err,dat,final)};for(var _i=0,chks_3=chks_2;_i<chks_3.length;_i++){var dat=chks_3[_i];d_1.push(dat,!1)}_this_1.k[0]==chks_2&&_this_1.c?_this_1.d=d_1:d_1.push(et,!0)}else file_1.ondata(null,et,!0)},terminate:function(){d_1&&d_1.terminate&&d_1.terminate()}};sc_1>=0&&(file_1.size=sc_1,file_1.originalSize=su_1),this_1.onfile(file_1)}return"break"}if(oc){if(134695760==sig)return is=i+=12+(-2==oc&&8),f=3,this_1.c=0,"break";if(33639248==sig)return is=i-=4,f=3,this_1.c=0,"break"}},this_1=this;i<l-4;++i){if("break"===_loop_2())break}if(this.p=et,oc<0){var dat=f?buf.subarray(0,is-12-(-2==oc&&8)-(134695760==b4(buf,is-16)&&4)):buf.subarray(0,i);add?add.push(dat,!!f):this.k[+(2==f)].push(dat)}if(2&f)return this.push(buf.subarray(i),final);this.p=buf.subarray(i)}if(final){if(this.c)throw"invalid zip file";this.p=null}},Unzip.prototype.register=function(decoder){this.o[decoder.compression]=decoder},Unzip}();function unzip(data,cb){if("function"!=typeof cb)throw"no callback";for(var term=[],tAll=function(){for(var i=0;i<term.length;++i)term[i]()},files={},e=data.length-22;101010256!=b4(data,e);--e)if(!e||data.length-e>65558)return void cb("invalid zip file",null);var lft=b2(data,e+8);lft||cb(null,{});var c=lft,o=b4(data,e+16),z=4294967295==o;if(z){if(e=b4(data,e-12),101075792!=b4(data,e))return void cb("invalid zip file",null);c=lft=b4(data,e+32),o=b4(data,e+48)}for(var _loop_3=function(i){var _a=zh(data,o,z),c_1=_a[0],sc=_a[1],su=_a[2],fn=_a[3],no=_a[4],off=_a[5],b=slzh(data,off);o=no;var cbl=function(e,d){e?(tAll(),cb(e,null)):(files[fn]=d,--lft||cb(null,files))};if(c_1)if(8==c_1){var infl=data.subarray(b,b+sc);if(sc<32e4)try{cbl(null,inflateSync(infl,new u8(su)))}catch(e){cbl(e,null)}else term.push(inflate(infl,{size:su},cbl))}else cbl("unknown compression type "+c_1,null);else cbl(null,slc(data,b,b+sc))},i=0;i<c;++i)_loop_3();return tAll}function unzipSync(data){for(var files={},e=data.length-22;101010256!=b4(data,e);--e)if(!e||data.length-e>65558)throw"invalid zip file";var c=b2(data,e+8);if(!c)return{};var o=b4(data,e+16),z=4294967295==o;if(z){if(e=b4(data,e-12),101075792!=b4(data,e))throw"invalid zip file";c=b4(data,e+32),o=b4(data,e+48)}for(var i=0;i<c;++i){var _a=zh(data,o,z),c_2=_a[0],sc=_a[1],su=_a[2],fn=_a[3],no=_a[4],off=_a[5],b=slzh(data,off);if(o=no,c_2){if(8!=c_2)throw"unknown compression type "+c_2;files[fn]=inflateSync(data.subarray(b,b+sc),new u8(su))}else files[fn]=slc(data,b,b+sc)}return files}function findSpan(p,u,U){const n=U.length-p-1;if(u>=U[n])return n-1;if(u<=U[p])return p;let low=p,high=n,mid=Math.floor((low+high)/2);for(;u<U[mid]||u>=U[mid+1];)u<U[mid]?high=mid:low=mid,mid=Math.floor((low+high)/2);return mid}function calcBasisFunctions(span,u,p,U){const N=[],left=[],right=[];N[0]=1;for(let j=1;j<=p;++j){left[j]=u-U[span+1-j],right[j]=U[span+j]-u;let saved=0;for(let r=0;r<j;++r){const rv=right[r+1],lv=left[j-r],temp=N[r]/(rv+lv);N[r]=saved+rv*temp,saved=lv*temp}N[j]=saved}return N}function calcKoverI(k,i){let nom=1;for(let j=2;j<=k;++j)nom*=j;let denom=1;for(let j=2;j<=i;++j)denom*=j;for(let j=2;j<=k-i;++j)denom*=j;return nom/denom}function calcNURBSDerivatives(p,U,P,u,nd){const Pders=function calcBSplineDerivatives(p,U,P,u,nd){const du=nd<p?nd:p,CK=[],span=findSpan(p,u,U),nders=function calcBasisFunctionDerivatives(span,u,p,n,U){const zeroArr=[];for(let i=0;i<=p;++i)zeroArr[i]=0;const ders=[];for(let i=0;i<=n;++i)ders[i]=zeroArr.slice(0);const ndu=[];for(let i=0;i<=p;++i)ndu[i]=zeroArr.slice(0);ndu[0][0]=1;const left=zeroArr.slice(0),right=zeroArr.slice(0);for(let j=1;j<=p;++j){left[j]=u-U[span+1-j],right[j]=U[span+j]-u;let saved=0;for(let r=0;r<j;++r){const rv=right[r+1],lv=left[j-r];ndu[j][r]=rv+lv;const temp=ndu[r][j-1]/ndu[j][r];ndu[r][j]=saved+rv*temp,saved=lv*temp}ndu[j][j]=saved}for(let j=0;j<=p;++j)ders[0][j]=ndu[j][p];for(let r=0;r<=p;++r){let s1=0,s2=1;const a=[];for(let i=0;i<=p;++i)a[i]=zeroArr.slice(0);a[0][0]=1;for(let k=1;k<=n;++k){let d=0;const rk=r-k,pk=p-k;r>=k&&(a[s2][0]=a[s1][0]/ndu[pk+1][rk],d=a[s2][0]*ndu[rk][pk]);const j2=r-1<=pk?k-1:p-r;for(let j=rk>=-1?1:-rk;j<=j2;++j)a[s2][j]=(a[s1][j]-a[s1][j-1])/ndu[pk+1][rk+j],d+=a[s2][j]*ndu[rk+j][pk];r<=pk&&(a[s2][k]=-a[s1][k-1]/ndu[pk+1][r],d+=a[s2][k]*ndu[r][pk]),ders[k][r]=d;const j=s1;s1=s2,s2=j}}let r=p;for(let k=1;k<=n;++k){for(let j=0;j<=p;++j)ders[k][j]*=r;r*=p-k}return ders}(span,u,p,du,U),Pw=[];for(let i=0;i<P.length;++i){const point=P[i].clone(),w=point.w;point.x*=w,point.y*=w,point.z*=w,Pw[i]=point}for(let k=0;k<=du;++k){const point=Pw[span-p].clone().multiplyScalar(nders[k][0]);for(let j=1;j<=p;++j)point.add(Pw[span-p+j].clone().multiplyScalar(nders[k][j]));CK[k]=point}for(let k=du+1;k<=nd+1;++k)CK[k]=new three_module.vd(0,0,0);return CK}(p,U,P,u,nd);return function calcRationalCurveDerivatives(Pders){const nd=Pders.length,Aders=[],wders=[];for(let i=0;i<nd;++i){const point=Pders[i];Aders[i]=new three_module.ud(point.x,point.y,point.z),wders[i]=point.w}const CK=[];for(let k=0;k<nd;++k){const v=Aders[k].clone();for(let i=1;i<=k;++i)v.sub(CK[k-i].clone().multiplyScalar(calcKoverI(k,i)*wders[i]));CK[k]=v.divideScalar(wders[0])}return CK}(Pders)}class NURBSCurve_NURBSCurve extends three_module.z{constructor(degree,knots,controlPoints,startKnot,endKnot){super(),this.degree=degree,this.knots=knots,this.controlPoints=[],this.startKnot=startKnot||0,this.endKnot=endKnot||this.knots.length-1;for(let i=0;i<controlPoints.length;++i){const point=controlPoints[i];this.controlPoints[i]=new three_module.vd(point.x,point.y,point.z,point.w)}}getPoint(t,optionalTarget=new three_module.ud){const point=optionalTarget,u=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),hpoint=function calcBSplinePoint(p,U,P,u){const span=findSpan(p,u,U),N=calcBasisFunctions(span,u,p,U),C=new three_module.vd(0,0,0,0);for(let j=0;j<=p;++j){const point=P[span-p+j],Nj=N[j],wNj=point.w*Nj;C.x+=point.x*wNj,C.y+=point.y*wNj,C.z+=point.z*wNj,C.w+=point.w*Nj}return C}(this.degree,this.knots,this.controlPoints,u);return 1!==hpoint.w&&hpoint.divideScalar(hpoint.w),point.set(hpoint.x,hpoint.y,hpoint.z)}getTangent(t,optionalTarget=new three_module.ud){const tangent=optionalTarget,u=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),ders=calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,u,1);return tangent.copy(ders[1]).normalize(),tangent}}let fbxTree,connections,sceneGraph;class FBXLoader_FBXLoader extends three_module.Ab{constructor(manager){super(manager)}load(url,onLoad,onProgress,onError){const scope=this,path=""===scope.path?three_module.Bb.extractUrlBase(url):scope.path,loader=new three_module.U(this.manager);loader.setPath(scope.path),loader.setResponseType("arraybuffer"),loader.setRequestHeader(scope.requestHeader),loader.setWithCredentials(scope.withCredentials),loader.load(url,(function(buffer){try{onLoad(scope.parse(buffer,path))}catch(e){onError?onError(e):console.error(e),scope.manager.itemError(url)}}),onProgress,onError)}parse(FBXBuffer,path){if(function isFbxFormatBinary(buffer){const CORRECT="Kaydara FBX Binary  \0";return buffer.byteLength>=CORRECT.length&&CORRECT===convertArrayBufferToString(buffer,0,CORRECT.length)}(FBXBuffer))fbxTree=(new FBXLoader_BinaryParser).parse(FBXBuffer);else{const FBXText=convertArrayBufferToString(FBXBuffer);if(!function isFbxFormatASCII(text){const CORRECT=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let cursor=0;function read(offset){const result=text[offset-1];return text=text.slice(cursor+offset),cursor++,result}for(let i=0;i<CORRECT.length;++i){if(read(1)===CORRECT[i])return!1}return!0}(FBXText))throw new Error("THREE.FBXLoader: Unknown format.");if(getFbxVersion(FBXText)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+getFbxVersion(FBXText));fbxTree=(new TextParser).parse(FBXText)}const textureLoader=new three_module.ed(this.manager).setPath(this.resourcePath||path).setCrossOrigin(this.crossOrigin);return new FBXLoader_FBXTreeParser(textureLoader,this.manager).parse(fbxTree)}}class FBXLoader_FBXTreeParser{constructor(textureLoader,manager){this.textureLoader=textureLoader,this.manager=manager}parse(){connections=this.parseConnections();const images=this.parseImages(),textures=this.parseTextures(images),materials=this.parseMaterials(textures),deformers=this.parseDeformers(),geometryMap=(new FBXLoader_GeometryParser).parse(deformers);return this.parseScene(deformers,geometryMap,materials),sceneGraph}parseConnections(){const connectionMap=new Map;if("Connections"in fbxTree){fbxTree.Connections.connections.forEach((function(rawConnection){const fromID=rawConnection[0],toID=rawConnection[1],relationship=rawConnection[2];connectionMap.has(fromID)||connectionMap.set(fromID,{parents:[],children:[]});const parentRelationship={ID:toID,relationship:relationship};connectionMap.get(fromID).parents.push(parentRelationship),connectionMap.has(toID)||connectionMap.set(toID,{parents:[],children:[]});const childRelationship={ID:fromID,relationship:relationship};connectionMap.get(toID).children.push(childRelationship)}))}return connectionMap}parseImages(){const images={},blobs={};if("Video"in fbxTree.Objects){const videoNodes=fbxTree.Objects.Video;for(const nodeID in videoNodes){const videoNode=videoNodes[nodeID];if(images[parseInt(nodeID)]=videoNode.RelativeFilename||videoNode.Filename,"Content"in videoNode){const arrayBufferContent=videoNode.Content instanceof ArrayBuffer&&videoNode.Content.byteLength>0,base64Content="string"==typeof videoNode.Content&&""!==videoNode.Content;if(arrayBufferContent||base64Content){const image=this.parseImage(videoNodes[nodeID]);blobs[videoNode.RelativeFilename||videoNode.Filename]=image}}}}for(const id in images){const filename=images[id];void 0!==blobs[filename]?images[id]=blobs[filename]:images[id]=images[id].split("\\").pop()}return images}parseImage(videoNode){const content=videoNode.Content,fileName=videoNode.RelativeFilename||videoNode.Filename,extension=fileName.slice(fileName.lastIndexOf(".")+1).toLowerCase();let type;switch(extension){case"bmp":type="image/bmp";break;case"jpg":case"jpeg":type="image/jpeg";break;case"png":type="image/png";break;case"tif":type="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",fileName),type="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+extension+'" is not supported.')}if("string"==typeof content)return"data:"+type+";base64,"+content;{const array=new Uint8Array(content);return window.URL.createObjectURL(new Blob([array],{type:type}))}}parseTextures(images){const textureMap=new Map;if("Texture"in fbxTree.Objects){const textureNodes=fbxTree.Objects.Texture;for(const nodeID in textureNodes){const texture=this.parseTexture(textureNodes[nodeID],images);textureMap.set(parseInt(nodeID),texture)}}return textureMap}parseTexture(textureNode,images){const texture=this.loadTexture(textureNode,images);texture.ID=textureNode.id,texture.name=textureNode.attrName;const wrapModeU=textureNode.WrapModeU,wrapModeV=textureNode.WrapModeV,valueU=void 0!==wrapModeU?wrapModeU.value:0,valueV=void 0!==wrapModeV?wrapModeV.value:0;if(texture.wrapS=0===valueU?three_module.Hc:three_module.u,texture.wrapT=0===valueV?three_module.Hc:three_module.u,"Scaling"in textureNode){const values=textureNode.Scaling.value;texture.repeat.x=values[0],texture.repeat.y=values[1]}if("Translation"in textureNode){const values=textureNode.Translation.value;texture.offset.x=values[0],texture.offset.y=values[1]}return texture}loadTexture(textureNode,images){let fileName;const currentPath=this.textureLoader.path,children=connections.get(textureNode.id).children;let texture;void 0!==children&&children.length>0&&void 0!==images[children[0].ID]&&(fileName=images[children[0].ID],0!==fileName.indexOf("blob:")&&0!==fileName.indexOf("data:")||this.textureLoader.setPath(void 0));const extension=textureNode.FileName.slice(-3).toLowerCase();if("tga"===extension){const loader=this.manager.getHandler(".tga");null===loader?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",textureNode.RelativeFilename),texture=new three_module.dd):(loader.setPath(this.textureLoader.path),texture=loader.load(fileName))}else"psd"===extension?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",textureNode.RelativeFilename),texture=new three_module.dd):texture=this.textureLoader.load(fileName);return this.textureLoader.setPath(currentPath),texture}parseMaterials(textureMap){const materialMap=new Map;if("Material"in fbxTree.Objects){const materialNodes=fbxTree.Objects.Material;for(const nodeID in materialNodes){const material=this.parseMaterial(materialNodes[nodeID],textureMap);null!==material&&materialMap.set(parseInt(nodeID),material)}}return materialMap}parseMaterial(materialNode,textureMap){const ID=materialNode.id,name=materialNode.attrName;let type=materialNode.ShadingModel;if("object"==typeof type&&(type=type.value),!connections.has(ID))return null;const parameters=this.parseParameters(materialNode,textureMap,ID);let material;switch(type.toLowerCase()){case"phong":material=new three_module.Qb;break;case"lambert":material=new three_module.Ob;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',type),material=new three_module.Qb}return material.setValues(parameters),material.name=name,material}parseParameters(materialNode,textureMap,ID){const parameters={};materialNode.BumpFactor&&(parameters.bumpScale=materialNode.BumpFactor.value),materialNode.Diffuse?parameters.color=(new three_module.w).fromArray(materialNode.Diffuse.value):!materialNode.DiffuseColor||"Color"!==materialNode.DiffuseColor.type&&"ColorRGB"!==materialNode.DiffuseColor.type||(parameters.color=(new three_module.w).fromArray(materialNode.DiffuseColor.value)),materialNode.DisplacementFactor&&(parameters.displacementScale=materialNode.DisplacementFactor.value),materialNode.Emissive?parameters.emissive=(new three_module.w).fromArray(materialNode.Emissive.value):!materialNode.EmissiveColor||"Color"!==materialNode.EmissiveColor.type&&"ColorRGB"!==materialNode.EmissiveColor.type||(parameters.emissive=(new three_module.w).fromArray(materialNode.EmissiveColor.value)),materialNode.EmissiveFactor&&(parameters.emissiveIntensity=parseFloat(materialNode.EmissiveFactor.value)),materialNode.Opacity&&(parameters.opacity=parseFloat(materialNode.Opacity.value)),parameters.opacity<1&&(parameters.transparent=!0),materialNode.ReflectionFactor&&(parameters.reflectivity=materialNode.ReflectionFactor.value),materialNode.Shininess&&(parameters.shininess=materialNode.Shininess.value),materialNode.Specular?parameters.specular=(new three_module.w).fromArray(materialNode.Specular.value):materialNode.SpecularColor&&"Color"===materialNode.SpecularColor.type&&(parameters.specular=(new three_module.w).fromArray(materialNode.SpecularColor.value));const scope=this;return connections.get(ID).children.forEach((function(child){const type=child.relationship;switch(type){case"Bump":parameters.bumpMap=scope.getTexture(textureMap,child.ID);break;case"Maya|TEX_ao_map":parameters.aoMap=scope.getTexture(textureMap,child.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":parameters.map=scope.getTexture(textureMap,child.ID),void 0!==parameters.map&&(parameters.map.encoding=three_module.Cd);break;case"DisplacementColor":parameters.displacementMap=scope.getTexture(textureMap,child.ID);break;case"EmissiveColor":parameters.emissiveMap=scope.getTexture(textureMap,child.ID),void 0!==parameters.emissiveMap&&(parameters.emissiveMap.encoding=three_module.Cd);break;case"NormalMap":case"Maya|TEX_normal_map":parameters.normalMap=scope.getTexture(textureMap,child.ID);break;case"ReflectionColor":parameters.envMap=scope.getTexture(textureMap,child.ID),void 0!==parameters.envMap&&(parameters.envMap.mapping=three_module.Q,parameters.envMap.encoding=three_module.Cd);break;case"SpecularColor":parameters.specularMap=scope.getTexture(textureMap,child.ID),void 0!==parameters.specularMap&&(parameters.specularMap.encoding=three_module.Cd);break;case"TransparentColor":case"TransparencyFactor":parameters.alphaMap=scope.getTexture(textureMap,child.ID),parameters.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",type)}})),parameters}getTexture(textureMap,id){return"LayeredTexture"in fbxTree.Objects&&id in fbxTree.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),id=connections.get(id).children[0].ID),textureMap.get(id)}parseDeformers(){const skeletons={},morphTargets={};if("Deformer"in fbxTree.Objects){const DeformerNodes=fbxTree.Objects.Deformer;for(const nodeID in DeformerNodes){const deformerNode=DeformerNodes[nodeID],relationships=connections.get(parseInt(nodeID));if("Skin"===deformerNode.attrType){const skeleton=this.parseSkeleton(relationships,DeformerNodes);skeleton.ID=nodeID,relationships.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),skeleton.geometryID=relationships.parents[0].ID,skeletons[nodeID]=skeleton}else if("BlendShape"===deformerNode.attrType){const morphTarget={id:nodeID};morphTarget.rawTargets=this.parseMorphTargets(relationships,DeformerNodes),morphTarget.id=nodeID,relationships.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),morphTargets[nodeID]=morphTarget}}}return{skeletons:skeletons,morphTargets:morphTargets}}parseSkeleton(relationships,deformerNodes){const rawBones=[];return relationships.children.forEach((function(child){const boneNode=deformerNodes[child.ID];if("Cluster"!==boneNode.attrType)return;const rawBone={ID:child.ID,indices:[],weights:[],transformLink:(new three_module.Kb).fromArray(boneNode.TransformLink.a)};"Indexes"in boneNode&&(rawBone.indices=boneNode.Indexes.a,rawBone.weights=boneNode.Weights.a),rawBones.push(rawBone)})),{rawBones:rawBones,bones:[]}}parseMorphTargets(relationships,deformerNodes){const rawMorphTargets=[];for(let i=0;i<relationships.children.length;i++){const child=relationships.children[i],morphTargetNode=deformerNodes[child.ID],rawMorphTarget={name:morphTargetNode.attrName,initialWeight:morphTargetNode.DeformPercent,id:morphTargetNode.id,fullWeights:morphTargetNode.FullWeights.a};if("BlendShapeChannel"!==morphTargetNode.attrType)return;rawMorphTarget.geoID=connections.get(parseInt(child.ID)).children.filter((function(child){return void 0===child.relationship}))[0].ID,rawMorphTargets.push(rawMorphTarget)}return rawMorphTargets}parseScene(deformers,geometryMap,materialMap){sceneGraph=new three_module.db;const modelMap=this.parseModels(deformers.skeletons,geometryMap,materialMap),modelNodes=fbxTree.Objects.Model,scope=this;modelMap.forEach((function(model){const modelNode=modelNodes[model.ID];scope.setLookAtProperties(model,modelNode);connections.get(model.ID).parents.forEach((function(connection){const parent=modelMap.get(connection.ID);void 0!==parent&&parent.add(model)})),null===model.parent&&sceneGraph.add(model)})),this.bindSkeleton(deformers.skeletons,geometryMap,modelMap),this.createAmbientLight(),sceneGraph.traverse((function(node){if(node.userData.transformData){node.parent&&(node.userData.transformData.parentMatrix=node.parent.matrix,node.userData.transformData.parentMatrixWorld=node.parent.matrixWorld);const transform=generateTransform(node.userData.transformData);node.applyMatrix4(transform),node.updateWorldMatrix()}}));const animations=(new FBXLoader_AnimationParser).parse();1===sceneGraph.children.length&&sceneGraph.children[0].isGroup&&(sceneGraph.children[0].animations=animations,sceneGraph=sceneGraph.children[0]),sceneGraph.animations=animations}parseModels(skeletons,geometryMap,materialMap){const modelMap=new Map,modelNodes=fbxTree.Objects.Model;for(const nodeID in modelNodes){const id=parseInt(nodeID),node=modelNodes[nodeID],relationships=connections.get(id);let model=this.buildSkeleton(relationships,skeletons,id,node.attrName);if(!model){switch(node.attrType){case"Camera":model=this.createCamera(relationships);break;case"Light":model=this.createLight(relationships);break;case"Mesh":model=this.createMesh(relationships,geometryMap,materialMap);break;case"NurbsCurve":model=this.createCurve(relationships,geometryMap);break;case"LimbNode":case"Root":model=new three_module.i;break;default:model=new three_module.db}model.name=node.attrName?three_module.tc.sanitizeNodeName(node.attrName):"",model.ID=id}this.getTransformData(model,node),modelMap.set(id,model)}return modelMap}buildSkeleton(relationships,skeletons,id,name){let bone=null;return relationships.parents.forEach((function(parent){for(const ID in skeletons){const skeleton=skeletons[ID];skeleton.rawBones.forEach((function(rawBone,i){if(rawBone.ID===parent.ID){const subBone=bone;bone=new three_module.i,bone.matrixWorld.copy(rawBone.transformLink),bone.name=name?three_module.tc.sanitizeNodeName(name):"",bone.ID=id,skeleton.bones[i]=bone,null!==subBone&&bone.add(subBone)}}))}})),bone}createCamera(relationships){let model,cameraAttribute;if(relationships.children.forEach((function(child){const attr=fbxTree.Objects.NodeAttribute[child.ID];void 0!==attr&&(cameraAttribute=attr)})),void 0===cameraAttribute)model=new three_module.ec;else{let type=0;void 0!==cameraAttribute.CameraProjectionType&&1===cameraAttribute.CameraProjectionType.value&&(type=1);let nearClippingPlane=1;void 0!==cameraAttribute.NearPlane&&(nearClippingPlane=cameraAttribute.NearPlane.value/1e3);let farClippingPlane=1e3;void 0!==cameraAttribute.FarPlane&&(farClippingPlane=cameraAttribute.FarPlane.value/1e3);let width=window.innerWidth,height=window.innerHeight;void 0!==cameraAttribute.AspectWidth&&void 0!==cameraAttribute.AspectHeight&&(width=cameraAttribute.AspectWidth.value,height=cameraAttribute.AspectHeight.value);const aspect=width/height;let fov=45;void 0!==cameraAttribute.FieldOfView&&(fov=cameraAttribute.FieldOfView.value);const focalLength=cameraAttribute.FocalLength?cameraAttribute.FocalLength.value:null;switch(type){case 0:model=new three_module.lc(fov,aspect,nearClippingPlane,farClippingPlane),null!==focalLength&&model.setFocalLength(focalLength);break;case 1:model=new three_module.jc(-width/2,width/2,height/2,-height/2,nearClippingPlane,farClippingPlane);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+type+"."),model=new three_module.ec}}return model}createLight(relationships){let model,lightAttribute;if(relationships.children.forEach((function(child){const attr=fbxTree.Objects.NodeAttribute[child.ID];void 0!==attr&&(lightAttribute=attr)})),void 0===lightAttribute)model=new three_module.ec;else{let type;type=void 0===lightAttribute.LightType?0:lightAttribute.LightType.value;let color=16777215;void 0!==lightAttribute.Color&&(color=(new three_module.w).fromArray(lightAttribute.Color.value));let intensity=void 0===lightAttribute.Intensity?1:lightAttribute.Intensity.value/100;void 0!==lightAttribute.CastLightOnObject&&0===lightAttribute.CastLightOnObject.value&&(intensity=0);let distance=0;void 0!==lightAttribute.FarAttenuationEnd&&(distance=void 0!==lightAttribute.EnableFarAttenuation&&0===lightAttribute.EnableFarAttenuation.value?0:lightAttribute.FarAttenuationEnd.value);const decay=1;switch(type){case 0:model=new three_module.pc(color,intensity,distance,decay);break;case 1:model=new three_module.K(color,intensity);break;case 2:let angle=Math.PI/3;void 0!==lightAttribute.InnerAngle&&(angle=three_module.Ib.degToRad(lightAttribute.InnerAngle.value));let penumbra=0;void 0!==lightAttribute.OuterAngle&&(penumbra=three_module.Ib.degToRad(lightAttribute.OuterAngle.value),penumbra=Math.max(penumbra,1)),model=new three_module.Vc(color,intensity,distance,angle,penumbra,decay);break;default:console.warn("THREE.FBXLoader: Unknown light type "+lightAttribute.LightType.value+", defaulting to a PointLight."),model=new three_module.pc(color,intensity)}void 0!==lightAttribute.CastShadows&&1===lightAttribute.CastShadows.value&&(model.castShadow=!0)}return model}createMesh(relationships,geometryMap,materialMap){let model,geometry=null,material=null;const materials=[];return relationships.children.forEach((function(child){geometryMap.has(child.ID)&&(geometry=geometryMap.get(child.ID)),materialMap.has(child.ID)&&materials.push(materialMap.get(child.ID))})),materials.length>1?material=materials:materials.length>0?material=materials[0]:(material=new three_module.Qb({color:13421772}),materials.push(material)),"color"in geometry.attributes&&materials.forEach((function(material){material.vertexColors=!0})),geometry.FBX_Deformer?(model=new three_module.Qc(geometry,material),model.normalizeSkinWeights()):model=new three_module.Lb(geometry,material),model}createCurve(relationships,geometryMap){const geometry=relationships.children.reduce((function(geo,child){return geometryMap.has(child.ID)&&(geo=geometryMap.get(child.ID)),geo}),null),material=new three_module.sb({color:3342591,linewidth:1});return new three_module.qb(geometry,material)}getTransformData(model,modelNode){const transformData={};"InheritType"in modelNode&&(transformData.inheritType=parseInt(modelNode.InheritType.value)),transformData.eulerOrder="RotationOrder"in modelNode?getEulerOrder(modelNode.RotationOrder.value):"ZYX","Lcl_Translation"in modelNode&&(transformData.translation=modelNode.Lcl_Translation.value),"PreRotation"in modelNode&&(transformData.preRotation=modelNode.PreRotation.value),"Lcl_Rotation"in modelNode&&(transformData.rotation=modelNode.Lcl_Rotation.value),"PostRotation"in modelNode&&(transformData.postRotation=modelNode.PostRotation.value),"Lcl_Scaling"in modelNode&&(transformData.scale=modelNode.Lcl_Scaling.value),"ScalingOffset"in modelNode&&(transformData.scalingOffset=modelNode.ScalingOffset.value),"ScalingPivot"in modelNode&&(transformData.scalingPivot=modelNode.ScalingPivot.value),"RotationOffset"in modelNode&&(transformData.rotationOffset=modelNode.RotationOffset.value),"RotationPivot"in modelNode&&(transformData.rotationPivot=modelNode.RotationPivot.value),model.userData.transformData=transformData}setLookAtProperties(model,modelNode){if("LookAtProperty"in modelNode){connections.get(model.ID).children.forEach((function(child){if("LookAtProperty"===child.relationship){const lookAtTarget=fbxTree.Objects.Model[child.ID];if("Lcl_Translation"in lookAtTarget){const pos=lookAtTarget.Lcl_Translation.value;void 0!==model.target?(model.target.position.fromArray(pos),sceneGraph.add(model.target)):model.lookAt((new three_module.ud).fromArray(pos))}}}))}}bindSkeleton(skeletons,geometryMap,modelMap){const bindMatrices=this.parsePoseNodes();for(const ID in skeletons){const skeleton=skeletons[ID];connections.get(parseInt(skeleton.ID)).parents.forEach((function(parent){if(geometryMap.has(parent.ID)){const geoID=parent.ID;connections.get(geoID).parents.forEach((function(geoConnParent){if(modelMap.has(geoConnParent.ID)){modelMap.get(geoConnParent.ID).bind(new three_module.Oc(skeleton.bones),bindMatrices[geoConnParent.ID])}}))}}))}}parsePoseNodes(){const bindMatrices={};if("Pose"in fbxTree.Objects){const BindPoseNode=fbxTree.Objects.Pose;for(const nodeID in BindPoseNode)if("BindPose"===BindPoseNode[nodeID].attrType&&BindPoseNode[nodeID].NbPoseNodes>0){const poseNodes=BindPoseNode[nodeID].PoseNode;Array.isArray(poseNodes)?poseNodes.forEach((function(poseNode){bindMatrices[poseNode.Node]=(new three_module.Kb).fromArray(poseNode.Matrix.a)})):bindMatrices[poseNodes.Node]=(new three_module.Kb).fromArray(poseNodes.Matrix.a)}}return bindMatrices}createAmbientLight(){if("GlobalSettings"in fbxTree&&"AmbientColor"in fbxTree.GlobalSettings){const ambientColor=fbxTree.GlobalSettings.AmbientColor.value,r=ambientColor[0],g=ambientColor[1],b=ambientColor[2];if(0!==r||0!==g||0!==b){const color=new three_module.w(r,g,b);sceneGraph.add(new three_module.d(color,1))}}}}class FBXLoader_GeometryParser{parse(deformers){const geometryMap=new Map;if("Geometry"in fbxTree.Objects){const geoNodes=fbxTree.Objects.Geometry;for(const nodeID in geoNodes){const relationships=connections.get(parseInt(nodeID)),geo=this.parseGeometry(relationships,geoNodes[nodeID],deformers);geometryMap.set(parseInt(nodeID),geo)}}return geometryMap}parseGeometry(relationships,geoNode,deformers){switch(geoNode.attrType){case"Mesh":return this.parseMeshGeometry(relationships,geoNode,deformers);case"NurbsCurve":return this.parseNurbsGeometry(geoNode)}}parseMeshGeometry(relationships,geoNode,deformers){const skeletons=deformers.skeletons,morphTargets=[],modelNodes=relationships.parents.map((function(parent){return fbxTree.Objects.Model[parent.ID]}));if(0===modelNodes.length)return;const skeleton=relationships.children.reduce((function(skeleton,child){return void 0!==skeletons[child.ID]&&(skeleton=skeletons[child.ID]),skeleton}),null);relationships.children.forEach((function(child){void 0!==deformers.morphTargets[child.ID]&&morphTargets.push(deformers.morphTargets[child.ID])}));const modelNode=modelNodes[0],transformData={};"RotationOrder"in modelNode&&(transformData.eulerOrder=getEulerOrder(modelNode.RotationOrder.value)),"InheritType"in modelNode&&(transformData.inheritType=parseInt(modelNode.InheritType.value)),"GeometricTranslation"in modelNode&&(transformData.translation=modelNode.GeometricTranslation.value),"GeometricRotation"in modelNode&&(transformData.rotation=modelNode.GeometricRotation.value),"GeometricScaling"in modelNode&&(transformData.scale=modelNode.GeometricScaling.value);const transform=generateTransform(transformData);return this.genGeometry(geoNode,skeleton,morphTargets,transform)}genGeometry(geoNode,skeleton,morphTargets,preTransform){const geo=new three_module.p;geoNode.attrName&&(geo.name=geoNode.attrName);const geoInfo=this.parseGeoNode(geoNode,skeleton),buffers=this.genBuffers(geoInfo),positionAttribute=new three_module.V(buffers.vertex,3);if(positionAttribute.applyMatrix4(preTransform),geo.setAttribute("position",positionAttribute),buffers.colors.length>0&&geo.setAttribute("color",new three_module.V(buffers.colors,3)),skeleton&&(geo.setAttribute("skinIndex",new three_module.ld(buffers.weightsIndices,4)),geo.setAttribute("skinWeight",new three_module.V(buffers.vertexWeights,4)),geo.FBX_Deformer=skeleton),buffers.normal.length>0){const normalMatrix=(new three_module.Jb).getNormalMatrix(preTransform),normalAttribute=new three_module.V(buffers.normal,3);normalAttribute.applyNormalMatrix(normalMatrix),geo.setAttribute("normal",normalAttribute)}if(buffers.uvs.forEach((function(uvBuffer,i){let name="uv"+(i+1).toString();0===i&&(name="uv"),geo.setAttribute(name,new three_module.V(buffers.uvs[i],2))})),geoInfo.material&&"AllSame"!==geoInfo.material.mappingType){let prevMaterialIndex=buffers.materialIndex[0],startIndex=0;if(buffers.materialIndex.forEach((function(currentIndex,i){currentIndex!==prevMaterialIndex&&(geo.addGroup(startIndex,i-startIndex,prevMaterialIndex),prevMaterialIndex=currentIndex,startIndex=i)})),geo.groups.length>0){const lastGroup=geo.groups[geo.groups.length-1],lastIndex=lastGroup.start+lastGroup.count;lastIndex!==buffers.materialIndex.length&&geo.addGroup(lastIndex,buffers.materialIndex.length-lastIndex,prevMaterialIndex)}0===geo.groups.length&&geo.addGroup(0,buffers.materialIndex.length,buffers.materialIndex[0])}return this.addMorphTargets(geo,geoNode,morphTargets,preTransform),geo}parseGeoNode(geoNode,skeleton){const geoInfo={};if(geoInfo.vertexPositions=void 0!==geoNode.Vertices?geoNode.Vertices.a:[],geoInfo.vertexIndices=void 0!==geoNode.PolygonVertexIndex?geoNode.PolygonVertexIndex.a:[],geoNode.LayerElementColor&&(geoInfo.color=this.parseVertexColors(geoNode.LayerElementColor[0])),geoNode.LayerElementMaterial&&(geoInfo.material=this.parseMaterialIndices(geoNode.LayerElementMaterial[0])),geoNode.LayerElementNormal&&(geoInfo.normal=this.parseNormals(geoNode.LayerElementNormal[0])),geoNode.LayerElementUV){geoInfo.uv=[];let i=0;for(;geoNode.LayerElementUV[i];)geoNode.LayerElementUV[i].UV&&geoInfo.uv.push(this.parseUVs(geoNode.LayerElementUV[i])),i++}return geoInfo.weightTable={},null!==skeleton&&(geoInfo.skeleton=skeleton,skeleton.rawBones.forEach((function(rawBone,i){rawBone.indices.forEach((function(index,j){void 0===geoInfo.weightTable[index]&&(geoInfo.weightTable[index]=[]),geoInfo.weightTable[index].push({id:i,weight:rawBone.weights[j]})}))}))),geoInfo}genBuffers(geoInfo){const buffers={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let polygonIndex=0,faceLength=0,displayedWeightsWarning=!1,facePositionIndexes=[],faceNormals=[],faceColors=[],faceUVs=[],faceWeights=[],faceWeightIndices=[];const scope=this;return geoInfo.vertexIndices.forEach((function(vertexIndex,polygonVertexIndex){let materialIndex,endOfFace=!1;vertexIndex<0&&(vertexIndex^=-1,endOfFace=!0);let weightIndices=[],weights=[];if(facePositionIndexes.push(3*vertexIndex,3*vertexIndex+1,3*vertexIndex+2),geoInfo.color){const data=getData(polygonVertexIndex,polygonIndex,vertexIndex,geoInfo.color);faceColors.push(data[0],data[1],data[2])}if(geoInfo.skeleton){if(void 0!==geoInfo.weightTable[vertexIndex]&&geoInfo.weightTable[vertexIndex].forEach((function(wt){weights.push(wt.weight),weightIndices.push(wt.id)})),weights.length>4){displayedWeightsWarning||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),displayedWeightsWarning=!0);const wIndex=[0,0,0,0],Weight=[0,0,0,0];weights.forEach((function(weight,weightIndex){let currentWeight=weight,currentIndex=weightIndices[weightIndex];Weight.forEach((function(comparedWeight,comparedWeightIndex,comparedWeightArray){if(currentWeight>comparedWeight){comparedWeightArray[comparedWeightIndex]=currentWeight,currentWeight=comparedWeight;const tmp=wIndex[comparedWeightIndex];wIndex[comparedWeightIndex]=currentIndex,currentIndex=tmp}}))})),weightIndices=wIndex,weights=Weight}for(;weights.length<4;)weights.push(0),weightIndices.push(0);for(let i=0;i<4;++i)faceWeights.push(weights[i]),faceWeightIndices.push(weightIndices[i])}if(geoInfo.normal){const data=getData(polygonVertexIndex,polygonIndex,vertexIndex,geoInfo.normal);faceNormals.push(data[0],data[1],data[2])}geoInfo.material&&"AllSame"!==geoInfo.material.mappingType&&(materialIndex=getData(polygonVertexIndex,polygonIndex,vertexIndex,geoInfo.material)[0]),geoInfo.uv&&geoInfo.uv.forEach((function(uv,i){const data=getData(polygonVertexIndex,polygonIndex,vertexIndex,uv);void 0===faceUVs[i]&&(faceUVs[i]=[]),faceUVs[i].push(data[0]),faceUVs[i].push(data[1])})),faceLength++,endOfFace&&(scope.genFace(buffers,geoInfo,facePositionIndexes,materialIndex,faceNormals,faceColors,faceUVs,faceWeights,faceWeightIndices,faceLength),polygonIndex++,faceLength=0,facePositionIndexes=[],faceNormals=[],faceColors=[],faceUVs=[],faceWeights=[],faceWeightIndices=[])})),buffers}genFace(buffers,geoInfo,facePositionIndexes,materialIndex,faceNormals,faceColors,faceUVs,faceWeights,faceWeightIndices,faceLength){for(let i=2;i<faceLength;i++)buffers.vertex.push(geoInfo.vertexPositions[facePositionIndexes[0]]),buffers.vertex.push(geoInfo.vertexPositions[facePositionIndexes[1]]),buffers.vertex.push(geoInfo.vertexPositions[facePositionIndexes[2]]),buffers.vertex.push(geoInfo.vertexPositions[facePositionIndexes[3*(i-1)]]),buffers.vertex.push(geoInfo.vertexPositions[facePositionIndexes[3*(i-1)+1]]),buffers.vertex.push(geoInfo.vertexPositions[facePositionIndexes[3*(i-1)+2]]),buffers.vertex.push(geoInfo.vertexPositions[facePositionIndexes[3*i]]),buffers.vertex.push(geoInfo.vertexPositions[facePositionIndexes[3*i+1]]),buffers.vertex.push(geoInfo.vertexPositions[facePositionIndexes[3*i+2]]),geoInfo.skeleton&&(buffers.vertexWeights.push(faceWeights[0]),buffers.vertexWeights.push(faceWeights[1]),buffers.vertexWeights.push(faceWeights[2]),buffers.vertexWeights.push(faceWeights[3]),buffers.vertexWeights.push(faceWeights[4*(i-1)]),buffers.vertexWeights.push(faceWeights[4*(i-1)+1]),buffers.vertexWeights.push(faceWeights[4*(i-1)+2]),buffers.vertexWeights.push(faceWeights[4*(i-1)+3]),buffers.vertexWeights.push(faceWeights[4*i]),buffers.vertexWeights.push(faceWeights[4*i+1]),buffers.vertexWeights.push(faceWeights[4*i+2]),buffers.vertexWeights.push(faceWeights[4*i+3]),buffers.weightsIndices.push(faceWeightIndices[0]),buffers.weightsIndices.push(faceWeightIndices[1]),buffers.weightsIndices.push(faceWeightIndices[2]),buffers.weightsIndices.push(faceWeightIndices[3]),buffers.weightsIndices.push(faceWeightIndices[4*(i-1)]),buffers.weightsIndices.push(faceWeightIndices[4*(i-1)+1]),buffers.weightsIndices.push(faceWeightIndices[4*(i-1)+2]),buffers.weightsIndices.push(faceWeightIndices[4*(i-1)+3]),buffers.weightsIndices.push(faceWeightIndices[4*i]),buffers.weightsIndices.push(faceWeightIndices[4*i+1]),buffers.weightsIndices.push(faceWeightIndices[4*i+2]),buffers.weightsIndices.push(faceWeightIndices[4*i+3])),geoInfo.color&&(buffers.colors.push(faceColors[0]),buffers.colors.push(faceColors[1]),buffers.colors.push(faceColors[2]),buffers.colors.push(faceColors[3*(i-1)]),buffers.colors.push(faceColors[3*(i-1)+1]),buffers.colors.push(faceColors[3*(i-1)+2]),buffers.colors.push(faceColors[3*i]),buffers.colors.push(faceColors[3*i+1]),buffers.colors.push(faceColors[3*i+2])),geoInfo.material&&"AllSame"!==geoInfo.material.mappingType&&(buffers.materialIndex.push(materialIndex),buffers.materialIndex.push(materialIndex),buffers.materialIndex.push(materialIndex)),geoInfo.normal&&(buffers.normal.push(faceNormals[0]),buffers.normal.push(faceNormals[1]),buffers.normal.push(faceNormals[2]),buffers.normal.push(faceNormals[3*(i-1)]),buffers.normal.push(faceNormals[3*(i-1)+1]),buffers.normal.push(faceNormals[3*(i-1)+2]),buffers.normal.push(faceNormals[3*i]),buffers.normal.push(faceNormals[3*i+1]),buffers.normal.push(faceNormals[3*i+2])),geoInfo.uv&&geoInfo.uv.forEach((function(uv,j){void 0===buffers.uvs[j]&&(buffers.uvs[j]=[]),buffers.uvs[j].push(faceUVs[j][0]),buffers.uvs[j].push(faceUVs[j][1]),buffers.uvs[j].push(faceUVs[j][2*(i-1)]),buffers.uvs[j].push(faceUVs[j][2*(i-1)+1]),buffers.uvs[j].push(faceUVs[j][2*i]),buffers.uvs[j].push(faceUVs[j][2*i+1])}))}addMorphTargets(parentGeo,parentGeoNode,morphTargets,preTransform){if(0===morphTargets.length)return;parentGeo.morphTargetsRelative=!0,parentGeo.morphAttributes.position=[];const scope=this;morphTargets.forEach((function(morphTarget){morphTarget.rawTargets.forEach((function(rawTarget){const morphGeoNode=fbxTree.Objects.Geometry[rawTarget.geoID];void 0!==morphGeoNode&&scope.genMorphGeometry(parentGeo,parentGeoNode,morphGeoNode,preTransform,rawTarget.name)}))}))}genMorphGeometry(parentGeo,parentGeoNode,morphGeoNode,preTransform,name){const vertexIndices=void 0!==parentGeoNode.PolygonVertexIndex?parentGeoNode.PolygonVertexIndex.a:[],morphPositionsSparse=void 0!==morphGeoNode.Vertices?morphGeoNode.Vertices.a:[],indices=void 0!==morphGeoNode.Indexes?morphGeoNode.Indexes.a:[],length=3*parentGeo.attributes.position.count,morphPositions=new Float32Array(length);for(let i=0;i<indices.length;i++){const morphIndex=3*indices[i];morphPositions[morphIndex]=morphPositionsSparse[3*i],morphPositions[morphIndex+1]=morphPositionsSparse[3*i+1],morphPositions[morphIndex+2]=morphPositionsSparse[3*i+2]}const morphGeoInfo={vertexIndices:vertexIndices,vertexPositions:morphPositions},morphBuffers=this.genBuffers(morphGeoInfo),positionAttribute=new three_module.V(morphBuffers.vertex,3);positionAttribute.name=name||morphGeoNode.attrName,positionAttribute.applyMatrix4(preTransform),parentGeo.morphAttributes.position.push(positionAttribute)}parseNormals(NormalNode){const mappingType=NormalNode.MappingInformationType,referenceType=NormalNode.ReferenceInformationType,buffer=NormalNode.Normals.a;let indexBuffer=[];return"IndexToDirect"===referenceType&&("NormalIndex"in NormalNode?indexBuffer=NormalNode.NormalIndex.a:"NormalsIndex"in NormalNode&&(indexBuffer=NormalNode.NormalsIndex.a)),{dataSize:3,buffer:buffer,indices:indexBuffer,mappingType:mappingType,referenceType:referenceType}}parseUVs(UVNode){const mappingType=UVNode.MappingInformationType,referenceType=UVNode.ReferenceInformationType,buffer=UVNode.UV.a;let indexBuffer=[];return"IndexToDirect"===referenceType&&(indexBuffer=UVNode.UVIndex.a),{dataSize:2,buffer:buffer,indices:indexBuffer,mappingType:mappingType,referenceType:referenceType}}parseVertexColors(ColorNode){const mappingType=ColorNode.MappingInformationType,referenceType=ColorNode.ReferenceInformationType,buffer=ColorNode.Colors.a;let indexBuffer=[];return"IndexToDirect"===referenceType&&(indexBuffer=ColorNode.ColorIndex.a),{dataSize:4,buffer:buffer,indices:indexBuffer,mappingType:mappingType,referenceType:referenceType}}parseMaterialIndices(MaterialNode){const mappingType=MaterialNode.MappingInformationType,referenceType=MaterialNode.ReferenceInformationType;if("NoMappingInformation"===mappingType)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:referenceType};const materialIndexBuffer=MaterialNode.Materials.a,materialIndices=[];for(let i=0;i<materialIndexBuffer.length;++i)materialIndices.push(i);return{dataSize:1,buffer:materialIndexBuffer,indices:materialIndices,mappingType:mappingType,referenceType:referenceType}}parseNurbsGeometry(geoNode){if(void 0===NURBSCurve_NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new three_module.p;const order=parseInt(geoNode.Order);if(isNaN(order))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",geoNode.Order,geoNode.id),new three_module.p;const degree=order-1,knots=geoNode.KnotVector.a,controlPoints=[],pointsValues=geoNode.Points.a;for(let i=0,l=pointsValues.length;i<l;i+=4)controlPoints.push((new three_module.vd).fromArray(pointsValues,i));let startKnot,endKnot;if("Closed"===geoNode.Form)controlPoints.push(controlPoints[0]);else if("Periodic"===geoNode.Form){startKnot=degree,endKnot=knots.length-1-startKnot;for(let i=0;i<degree;++i)controlPoints.push(controlPoints[i])}const points=new NURBSCurve_NURBSCurve(degree,knots,controlPoints,startKnot,endKnot).getPoints(12*controlPoints.length);return(new three_module.p).setFromPoints(points)}}class FBXLoader_AnimationParser{parse(){const animationClips=[],rawClips=this.parseClips();if(void 0!==rawClips)for(const key in rawClips){const rawClip=rawClips[key],clip=this.addClip(rawClip);animationClips.push(clip)}return animationClips}parseClips(){if(void 0===fbxTree.Objects.AnimationCurve)return;const curveNodesMap=this.parseAnimationCurveNodes();this.parseAnimationCurves(curveNodesMap);const layersMap=this.parseAnimationLayers(curveNodesMap);return this.parseAnimStacks(layersMap)}parseAnimationCurveNodes(){const rawCurveNodes=fbxTree.Objects.AnimationCurveNode,curveNodesMap=new Map;for(const nodeID in rawCurveNodes){const rawCurveNode=rawCurveNodes[nodeID];if(null!==rawCurveNode.attrName.match(/S|R|T|DeformPercent/)){const curveNode={id:rawCurveNode.id,attr:rawCurveNode.attrName,curves:{}};curveNodesMap.set(curveNode.id,curveNode)}}return curveNodesMap}parseAnimationCurves(curveNodesMap){const rawCurves=fbxTree.Objects.AnimationCurve;for(const nodeID in rawCurves){const animationCurve={id:rawCurves[nodeID].id,times:rawCurves[nodeID].KeyTime.a.map(convertFBXTimeToSeconds),values:rawCurves[nodeID].KeyValueFloat.a},relationships=connections.get(animationCurve.id);if(void 0!==relationships){const animationCurveID=relationships.parents[0].ID,animationCurveRelationship=relationships.parents[0].relationship;animationCurveRelationship.match(/X/)?curveNodesMap.get(animationCurveID).curves.x=animationCurve:animationCurveRelationship.match(/Y/)?curveNodesMap.get(animationCurveID).curves.y=animationCurve:animationCurveRelationship.match(/Z/)?curveNodesMap.get(animationCurveID).curves.z=animationCurve:animationCurveRelationship.match(/d|DeformPercent/)&&curveNodesMap.has(animationCurveID)&&(curveNodesMap.get(animationCurveID).curves.morph=animationCurve)}}}parseAnimationLayers(curveNodesMap){const rawLayers=fbxTree.Objects.AnimationLayer,layersMap=new Map;for(const nodeID in rawLayers){const layerCurveNodes=[],connection=connections.get(parseInt(nodeID));if(void 0!==connection){connection.children.forEach((function(child,i){if(curveNodesMap.has(child.ID)){const curveNode=curveNodesMap.get(child.ID);if(void 0!==curveNode.curves.x||void 0!==curveNode.curves.y||void 0!==curveNode.curves.z){if(void 0===layerCurveNodes[i]){const modelID=connections.get(child.ID).parents.filter((function(parent){return void 0!==parent.relationship}))[0].ID;if(void 0!==modelID){const rawModel=fbxTree.Objects.Model[modelID.toString()];if(void 0===rawModel)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",child);const node={modelName:rawModel.attrName?three_module.tc.sanitizeNodeName(rawModel.attrName):"",ID:rawModel.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};sceneGraph.traverse((function(child){child.ID===rawModel.id&&(node.transform=child.matrix,child.userData.transformData&&(node.eulerOrder=child.userData.transformData.eulerOrder))})),node.transform||(node.transform=new three_module.Kb),"PreRotation"in rawModel&&(node.preRotation=rawModel.PreRotation.value),"PostRotation"in rawModel&&(node.postRotation=rawModel.PostRotation.value),layerCurveNodes[i]=node}}layerCurveNodes[i]&&(layerCurveNodes[i][curveNode.attr]=curveNode)}else if(void 0!==curveNode.curves.morph){if(void 0===layerCurveNodes[i]){const deformerID=connections.get(child.ID).parents.filter((function(parent){return void 0!==parent.relationship}))[0].ID,morpherID=connections.get(deformerID).parents[0].ID,geoID=connections.get(morpherID).parents[0].ID,modelID=connections.get(geoID).parents[0].ID,rawModel=fbxTree.Objects.Model[modelID],node={modelName:rawModel.attrName?three_module.tc.sanitizeNodeName(rawModel.attrName):"",morphName:fbxTree.Objects.Deformer[deformerID].attrName};layerCurveNodes[i]=node}layerCurveNodes[i][curveNode.attr]=curveNode}}})),layersMap.set(parseInt(nodeID),layerCurveNodes)}}return layersMap}parseAnimStacks(layersMap){const rawStacks=fbxTree.Objects.AnimationStack,rawClips={};for(const nodeID in rawStacks){const children=connections.get(parseInt(nodeID)).children;children.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const layer=layersMap.get(children[0].ID);rawClips[nodeID]={name:rawStacks[nodeID].attrName,layer:layer}}return rawClips}addClip(rawClip){let tracks=[];const scope=this;return rawClip.layer.forEach((function(rawTracks){tracks=tracks.concat(scope.generateTracks(rawTracks))})),new three_module.e(rawClip.name,-1,tracks)}generateTracks(rawTracks){const tracks=[];let initialPosition=new three_module.ud,initialRotation=new three_module.uc,initialScale=new three_module.ud;if(rawTracks.transform&&rawTracks.transform.decompose(initialPosition,initialRotation,initialScale),initialPosition=initialPosition.toArray(),initialRotation=(new three_module.R).setFromQuaternion(initialRotation,rawTracks.eulerOrder).toArray(),initialScale=initialScale.toArray(),void 0!==rawTracks.T&&Object.keys(rawTracks.T.curves).length>0){const positionTrack=this.generateVectorTrack(rawTracks.modelName,rawTracks.T.curves,initialPosition,"position");void 0!==positionTrack&&tracks.push(positionTrack)}if(void 0!==rawTracks.R&&Object.keys(rawTracks.R.curves).length>0){const rotationTrack=this.generateRotationTrack(rawTracks.modelName,rawTracks.R.curves,initialRotation,rawTracks.preRotation,rawTracks.postRotation,rawTracks.eulerOrder);void 0!==rotationTrack&&tracks.push(rotationTrack)}if(void 0!==rawTracks.S&&Object.keys(rawTracks.S.curves).length>0){const scaleTrack=this.generateVectorTrack(rawTracks.modelName,rawTracks.S.curves,initialScale,"scale");void 0!==scaleTrack&&tracks.push(scaleTrack)}if(void 0!==rawTracks.DeformPercent){const morphTrack=this.generateMorphTrack(rawTracks);void 0!==morphTrack&&tracks.push(morphTrack)}return tracks}generateVectorTrack(modelName,curves,initialValue,type){const times=this.getTimesForAllAxes(curves),values=this.getKeyframeTrackValues(times,curves,initialValue);return new three_module.wd(modelName+"."+type,times,values)}generateRotationTrack(modelName,curves,initialValue,preRotation,postRotation,eulerOrder){void 0!==curves.x&&(this.interpolateRotations(curves.x),curves.x.values=curves.x.values.map(three_module.Ib.degToRad)),void 0!==curves.y&&(this.interpolateRotations(curves.y),curves.y.values=curves.y.values.map(three_module.Ib.degToRad)),void 0!==curves.z&&(this.interpolateRotations(curves.z),curves.z.values=curves.z.values.map(three_module.Ib.degToRad));const times=this.getTimesForAllAxes(curves),values=this.getKeyframeTrackValues(times,curves,initialValue);void 0!==preRotation&&((preRotation=preRotation.map(three_module.Ib.degToRad)).push(eulerOrder),preRotation=(new three_module.R).fromArray(preRotation),preRotation=(new three_module.uc).setFromEuler(preRotation)),void 0!==postRotation&&((postRotation=postRotation.map(three_module.Ib.degToRad)).push(eulerOrder),postRotation=(new three_module.R).fromArray(postRotation),postRotation=(new three_module.uc).setFromEuler(postRotation).invert());const quaternion=new three_module.uc,euler=new three_module.R,quaternionValues=[];for(let i=0;i<values.length;i+=3)euler.set(values[i],values[i+1],values[i+2],eulerOrder),quaternion.setFromEuler(euler),void 0!==preRotation&&quaternion.premultiply(preRotation),void 0!==postRotation&&quaternion.multiply(postRotation),quaternion.toArray(quaternionValues,i/3*4);return new three_module.vc(modelName+".quaternion",times,quaternionValues)}generateMorphTrack(rawTracks){const curves=rawTracks.DeformPercent.curves.morph,values=curves.values.map((function(val){return val/100})),morphNum=sceneGraph.getObjectByName(rawTracks.modelName).morphTargetDictionary[rawTracks.morphName];return new three_module.dc(rawTracks.modelName+".morphTargetInfluences["+morphNum+"]",curves.times,values)}getTimesForAllAxes(curves){let times=[];if(void 0!==curves.x&&(times=times.concat(curves.x.times)),void 0!==curves.y&&(times=times.concat(curves.y.times)),void 0!==curves.z&&(times=times.concat(curves.z.times)),times=times.sort((function(a,b){return a-b})),times.length>1){let targetIndex=1,lastValue=times[0];for(let i=1;i<times.length;i++){const currentValue=times[i];currentValue!==lastValue&&(times[targetIndex]=currentValue,lastValue=currentValue,targetIndex++)}times=times.slice(0,targetIndex)}return times}getKeyframeTrackValues(times,curves,initialValue){const prevValue=initialValue,values=[];let xIndex=-1,yIndex=-1,zIndex=-1;return times.forEach((function(time){if(curves.x&&(xIndex=curves.x.times.indexOf(time)),curves.y&&(yIndex=curves.y.times.indexOf(time)),curves.z&&(zIndex=curves.z.times.indexOf(time)),-1!==xIndex){const xValue=curves.x.values[xIndex];values.push(xValue),prevValue[0]=xValue}else values.push(prevValue[0]);if(-1!==yIndex){const yValue=curves.y.values[yIndex];values.push(yValue),prevValue[1]=yValue}else values.push(prevValue[1]);if(-1!==zIndex){const zValue=curves.z.values[zIndex];values.push(zValue),prevValue[2]=zValue}else values.push(prevValue[2])})),values}interpolateRotations(curve){for(let i=1;i<curve.values.length;i++){const initialValue=curve.values[i-1],valuesSpan=curve.values[i]-initialValue,absoluteSpan=Math.abs(valuesSpan);if(absoluteSpan>=180){const numSubIntervals=absoluteSpan/180,step=valuesSpan/numSubIntervals;let nextValue=initialValue+step;const initialTime=curve.times[i-1],interval=(curve.times[i]-initialTime)/numSubIntervals;let nextTime=initialTime+interval;const interpolatedTimes=[],interpolatedValues=[];for(;nextTime<curve.times[i];)interpolatedTimes.push(nextTime),nextTime+=interval,interpolatedValues.push(nextValue),nextValue+=step;curve.times=inject(curve.times,i,interpolatedTimes),curve.values=inject(curve.values,i,interpolatedValues)}}}}class TextParser{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(node){this.nodeStack.push(node),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(val,name){this.currentProp=val,this.currentPropName=name}parse(text){this.currentIndent=0,this.allNodes=new FBXTree,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const scope=this,split=text.split(/[\r\n]+/);return split.forEach((function(line,i){const matchComment=line.match(/^[\s\t]*;/),matchEmpty=line.match(/^[\s\t]*$/);if(matchComment||matchEmpty)return;const matchBeginning=line.match("^\\t{"+scope.currentIndent+"}(\\w+):(.*){",""),matchProperty=line.match("^\\t{"+scope.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),matchEnd=line.match("^\\t{"+(scope.currentIndent-1)+"}}");matchBeginning?scope.parseNodeBegin(line,matchBeginning):matchProperty?scope.parseNodeProperty(line,matchProperty,split[++i]):matchEnd?scope.popStack():line.match(/^[^\s\t}]/)&&scope.parseNodePropertyContinued(line)})),this.allNodes}parseNodeBegin(line,property){const nodeName=property[1].trim().replace(/^"/,"").replace(/"$/,""),nodeAttrs=property[2].split(",").map((function(attr){return attr.trim().replace(/^"/,"").replace(/"$/,"")})),node={name:nodeName},attrs=this.parseNodeAttr(nodeAttrs),currentNode=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(nodeName,node):nodeName in currentNode?("PoseNode"===nodeName?currentNode.PoseNode.push(node):void 0!==currentNode[nodeName].id&&(currentNode[nodeName]={},currentNode[nodeName][currentNode[nodeName].id]=currentNode[nodeName]),""!==attrs.id&&(currentNode[nodeName][attrs.id]=node)):"number"==typeof attrs.id?(currentNode[nodeName]={},currentNode[nodeName][attrs.id]=node):"Properties70"!==nodeName&&(currentNode[nodeName]="PoseNode"===nodeName?[node]:node),"number"==typeof attrs.id&&(node.id=attrs.id),""!==attrs.name&&(node.attrName=attrs.name),""!==attrs.type&&(node.attrType=attrs.type),this.pushStack(node)}parseNodeAttr(attrs){let id=attrs[0];""!==attrs[0]&&(id=parseInt(attrs[0]),isNaN(id)&&(id=attrs[0]));let name="",type="";return attrs.length>1&&(name=attrs[1].replace(/^(\w+)::/,""),type=attrs[2]),{id:id,name:name,type:type}}parseNodeProperty(line,property,contentLine){let propName=property[1].replace(/^"/,"").replace(/"$/,"").trim(),propValue=property[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===propName&&","===propValue&&(propValue=contentLine.replace(/"/g,"").replace(/,$/,"").trim());const currentNode=this.getCurrentNode();if("Properties70"!==currentNode.name){if("C"===propName){const connProps=propValue.split(",").slice(1),from=parseInt(connProps[0]),to=parseInt(connProps[1]);let rest=propValue.split(",").slice(3);rest=rest.map((function(elem){return elem.trim().replace(/^"/,"")})),propName="connections",propValue=[from,to],function append(a,b){for(let i=0,j=a.length,l=b.length;i<l;i++,j++)a[j]=b[i]}(propValue,rest),void 0===currentNode[propName]&&(currentNode[propName]=[])}"Node"===propName&&(currentNode.id=propValue),propName in currentNode&&Array.isArray(currentNode[propName])?currentNode[propName].push(propValue):"a"!==propName?currentNode[propName]=propValue:currentNode.a=propValue,this.setCurrentProp(currentNode,propName),"a"===propName&&","!==propValue.slice(-1)&&(currentNode.a=parseNumberArray(propValue))}else this.parseNodeSpecialProperty(line,propName,propValue)}parseNodePropertyContinued(line){const currentNode=this.getCurrentNode();currentNode.a+=line,","!==line.slice(-1)&&(currentNode.a=parseNumberArray(currentNode.a))}parseNodeSpecialProperty(line,propName,propValue){const props=propValue.split('",').map((function(prop){return prop.trim().replace(/^\"/,"").replace(/\s/,"_")})),innerPropName=props[0],innerPropType1=props[1],innerPropType2=props[2],innerPropFlag=props[3];let innerPropValue=props[4];switch(innerPropType1){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":innerPropValue=parseFloat(innerPropValue);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":innerPropValue=parseNumberArray(innerPropValue)}this.getPrevNode()[innerPropName]={type:innerPropType1,type2:innerPropType2,flag:innerPropFlag,value:innerPropValue},this.setCurrentProp(this.getPrevNode(),innerPropName)}}class FBXLoader_BinaryParser{parse(buffer){const reader=new FBXLoader_BinaryReader(buffer);reader.skip(23);const version=reader.getUint32();if(version<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+version);const allNodes=new FBXTree;for(;!this.endOfContent(reader);){const node=this.parseNode(reader,version);null!==node&&allNodes.add(node.name,node)}return allNodes}endOfContent(reader){return reader.size()%16==0?(reader.getOffset()+160+16&-16)>=reader.size():reader.getOffset()+160+16>=reader.size()}parseNode(reader,version){const node={},endOffset=version>=7500?reader.getUint64():reader.getUint32(),numProperties=version>=7500?reader.getUint64():reader.getUint32();version>=7500?reader.getUint64():reader.getUint32();const nameLen=reader.getUint8(),name=reader.getString(nameLen);if(0===endOffset)return null;const propertyList=[];for(let i=0;i<numProperties;i++)propertyList.push(this.parseProperty(reader));const id=propertyList.length>0?propertyList[0]:"",attrName=propertyList.length>1?propertyList[1]:"",attrType=propertyList.length>2?propertyList[2]:"";for(node.singleProperty=1===numProperties&&reader.getOffset()===endOffset;endOffset>reader.getOffset();){const subNode=this.parseNode(reader,version);null!==subNode&&this.parseSubNode(name,node,subNode)}return node.propertyList=propertyList,"number"==typeof id&&(node.id=id),""!==attrName&&(node.attrName=attrName),""!==attrType&&(node.attrType=attrType),""!==name&&(node.name=name),node}parseSubNode(name,node,subNode){if(!0===subNode.singleProperty){const value=subNode.propertyList[0];Array.isArray(value)?(node[subNode.name]=subNode,subNode.a=value):node[subNode.name]=value}else if("Connections"===name&&"C"===subNode.name){const array=[];subNode.propertyList.forEach((function(property,i){0!==i&&array.push(property)})),void 0===node.connections&&(node.connections=[]),node.connections.push(array)}else if("Properties70"===subNode.name){Object.keys(subNode).forEach((function(key){node[key]=subNode[key]}))}else if("Properties70"===name&&"P"===subNode.name){let innerPropName=subNode.propertyList[0],innerPropType1=subNode.propertyList[1];const innerPropType2=subNode.propertyList[2],innerPropFlag=subNode.propertyList[3];let innerPropValue;0===innerPropName.indexOf("Lcl ")&&(innerPropName=innerPropName.replace("Lcl ","Lcl_")),0===innerPropType1.indexOf("Lcl ")&&(innerPropType1=innerPropType1.replace("Lcl ","Lcl_")),innerPropValue="Color"===innerPropType1||"ColorRGB"===innerPropType1||"Vector"===innerPropType1||"Vector3D"===innerPropType1||0===innerPropType1.indexOf("Lcl_")?[subNode.propertyList[4],subNode.propertyList[5],subNode.propertyList[6]]:subNode.propertyList[4],node[innerPropName]={type:innerPropType1,type2:innerPropType2,flag:innerPropFlag,value:innerPropValue}}else void 0===node[subNode.name]?"number"==typeof subNode.id?(node[subNode.name]={},node[subNode.name][subNode.id]=subNode):node[subNode.name]=subNode:"PoseNode"===subNode.name?(Array.isArray(node[subNode.name])||(node[subNode.name]=[node[subNode.name]]),node[subNode.name].push(subNode)):void 0===node[subNode.name][subNode.id]&&(node[subNode.name][subNode.id]=subNode)}parseProperty(reader){const type=reader.getString(1);let length;switch(type){case"C":return reader.getBoolean();case"D":return reader.getFloat64();case"F":return reader.getFloat32();case"I":return reader.getInt32();case"L":return reader.getInt64();case"R":return length=reader.getUint32(),reader.getArrayBuffer(length);case"S":return length=reader.getUint32(),reader.getString(length);case"Y":return reader.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const arrayLength=reader.getUint32(),encoding=reader.getUint32(),compressedLength=reader.getUint32();if(0===encoding)switch(type){case"b":case"c":return reader.getBooleanArray(arrayLength);case"d":return reader.getFloat64Array(arrayLength);case"f":return reader.getFloat32Array(arrayLength);case"i":return reader.getInt32Array(arrayLength);case"l":return reader.getInt64Array(arrayLength)}void 0===fflate_module_namespaceObject&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const data=unzlibSync(new Uint8Array(reader.getArrayBuffer(compressedLength))),reader2=new FBXLoader_BinaryReader(data.buffer);switch(type){case"b":case"c":return reader2.getBooleanArray(arrayLength);case"d":return reader2.getFloat64Array(arrayLength);case"f":return reader2.getFloat32Array(arrayLength);case"i":return reader2.getInt32Array(arrayLength);case"l":return reader2.getInt64Array(arrayLength)}default:throw new Error("THREE.FBXLoader: Unknown property type "+type)}}}class FBXLoader_BinaryReader{constructor(buffer,littleEndian){this.dv=new DataView(buffer),this.offset=0,this.littleEndian=void 0===littleEndian||littleEndian}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(length){this.offset+=length}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(size){const a=[];for(let i=0;i<size;i++)a.push(this.getBoolean());return a}getUint8(){const value=this.dv.getUint8(this.offset);return this.offset+=1,value}getInt16(){const value=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,value}getInt32(){const value=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,value}getInt32Array(size){const a=[];for(let i=0;i<size;i++)a.push(this.getInt32());return a}getUint32(){const value=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,value}getInt64(){let low,high;return this.littleEndian?(low=this.getUint32(),high=this.getUint32()):(high=this.getUint32(),low=this.getUint32()),2147483648&high?(high=4294967295&~high,low=4294967295&~low,4294967295===low&&(high=high+1&4294967295),low=low+1&4294967295,-(4294967296*high+low)):4294967296*high+low}getInt64Array(size){const a=[];for(let i=0;i<size;i++)a.push(this.getInt64());return a}getUint64(){let low,high;return this.littleEndian?(low=this.getUint32(),high=this.getUint32()):(high=this.getUint32(),low=this.getUint32()),4294967296*high+low}getFloat32(){const value=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,value}getFloat32Array(size){const a=[];for(let i=0;i<size;i++)a.push(this.getFloat32());return a}getFloat64(){const value=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,value}getFloat64Array(size){const a=[];for(let i=0;i<size;i++)a.push(this.getFloat64());return a}getArrayBuffer(size){const value=this.dv.buffer.slice(this.offset,this.offset+size);return this.offset+=size,value}getString(size){let a=[];for(let i=0;i<size;i++)a[i]=this.getUint8();const nullByte=a.indexOf(0);return nullByte>=0&&(a=a.slice(0,nullByte)),three_module.Bb.decodeText(new Uint8Array(a))}}class FBXTree{add(key,val){this[key]=val}}function getFbxVersion(text){const match=text.match(/FBXVersion: (\d+)/);if(match){return parseInt(match[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function convertFBXTimeToSeconds(time){return time/46186158e3}const dataArray=[];function getData(polygonVertexIndex,polygonIndex,vertexIndex,infoObject){let index;switch(infoObject.mappingType){case"ByPolygonVertex":index=polygonVertexIndex;break;case"ByPolygon":index=polygonIndex;break;case"ByVertice":index=vertexIndex;break;case"AllSame":index=infoObject.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+infoObject.mappingType)}"IndexToDirect"===infoObject.referenceType&&(index=infoObject.indices[index]);const from=index*infoObject.dataSize,to=from+infoObject.dataSize;return function slice(a,b,from,to){for(let i=from,j=0;i<to;i++,j++)a[j]=b[i];return a}(dataArray,infoObject.buffer,from,to)}const tempEuler=new three_module.R,tempVec=new three_module.ud;function generateTransform(transformData){const lTranslationM=new three_module.Kb,lPreRotationM=new three_module.Kb,lRotationM=new three_module.Kb,lPostRotationM=new three_module.Kb,lScalingM=new three_module.Kb,lScalingPivotM=new three_module.Kb,lScalingOffsetM=new three_module.Kb,lRotationOffsetM=new three_module.Kb,lRotationPivotM=new three_module.Kb,lParentGX=new three_module.Kb,lParentLX=new three_module.Kb,lGlobalT=new three_module.Kb,inheritType=transformData.inheritType?transformData.inheritType:0;if(transformData.translation&&lTranslationM.setPosition(tempVec.fromArray(transformData.translation)),transformData.preRotation){const array=transformData.preRotation.map(three_module.Ib.degToRad);array.push(transformData.eulerOrder),lPreRotationM.makeRotationFromEuler(tempEuler.fromArray(array))}if(transformData.rotation){const array=transformData.rotation.map(three_module.Ib.degToRad);array.push(transformData.eulerOrder),lRotationM.makeRotationFromEuler(tempEuler.fromArray(array))}if(transformData.postRotation){const array=transformData.postRotation.map(three_module.Ib.degToRad);array.push(transformData.eulerOrder),lPostRotationM.makeRotationFromEuler(tempEuler.fromArray(array)),lPostRotationM.invert()}transformData.scale&&lScalingM.scale(tempVec.fromArray(transformData.scale)),transformData.scalingOffset&&lScalingOffsetM.setPosition(tempVec.fromArray(transformData.scalingOffset)),transformData.scalingPivot&&lScalingPivotM.setPosition(tempVec.fromArray(transformData.scalingPivot)),transformData.rotationOffset&&lRotationOffsetM.setPosition(tempVec.fromArray(transformData.rotationOffset)),transformData.rotationPivot&&lRotationPivotM.setPosition(tempVec.fromArray(transformData.rotationPivot)),transformData.parentMatrixWorld&&(lParentLX.copy(transformData.parentMatrix),lParentGX.copy(transformData.parentMatrixWorld));const lLRM=lPreRotationM.clone().multiply(lRotationM).multiply(lPostRotationM),lParentGRM=new three_module.Kb;lParentGRM.extractRotation(lParentGX);const lParentTM=new three_module.Kb;lParentTM.copyPosition(lParentGX);const lParentGRSM=lParentTM.clone().invert().multiply(lParentGX),lParentGSM=lParentGRM.clone().invert().multiply(lParentGRSM),lLSM=lScalingM,lGlobalRS=new three_module.Kb;if(0===inheritType)lGlobalRS.copy(lParentGRM).multiply(lLRM).multiply(lParentGSM).multiply(lLSM);else if(1===inheritType)lGlobalRS.copy(lParentGRM).multiply(lParentGSM).multiply(lLRM).multiply(lLSM);else{const lParentLSM_inv=(new three_module.Kb).scale((new three_module.ud).setFromMatrixScale(lParentLX)).clone().invert(),lParentGSM_noLocal=lParentGSM.clone().multiply(lParentLSM_inv);lGlobalRS.copy(lParentGRM).multiply(lLRM).multiply(lParentGSM_noLocal).multiply(lLSM)}const lRotationPivotM_inv=lRotationPivotM.clone().invert(),lScalingPivotM_inv=lScalingPivotM.clone().invert();let lTransform=lTranslationM.clone().multiply(lRotationOffsetM).multiply(lRotationPivotM).multiply(lPreRotationM).multiply(lRotationM).multiply(lPostRotationM).multiply(lRotationPivotM_inv).multiply(lScalingOffsetM).multiply(lScalingPivotM).multiply(lScalingM).multiply(lScalingPivotM_inv);const lLocalTWithAllPivotAndOffsetInfo=(new three_module.Kb).copyPosition(lTransform),lGlobalTranslation=lParentGX.clone().multiply(lLocalTWithAllPivotAndOffsetInfo);return lGlobalT.copyPosition(lGlobalTranslation),lTransform=lGlobalT.clone().multiply(lGlobalRS),lTransform.premultiply(lParentGX.invert()),lTransform}function getEulerOrder(order){const enums=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(order=order||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),enums[0]):enums[order]}function parseNumberArray(value){return value.split(",").map((function(val){return parseFloat(val)}))}function convertArrayBufferToString(buffer,from,to){return void 0===from&&(from=0),void 0===to&&(to=buffer.byteLength),three_module.Bb.decodeText(new Uint8Array(buffer,from,to))}function inject(a1,index,a2){return a1.slice(0,index).concat(a2).concat(a1.slice(index))}var lib=__webpack_require__("./node_modules/@lincode/utils/lib/index.js"),cloneSkinnedMesh=__webpack_require__("./node_modules/lingo3d/lib/display/utils/cloneSkinnedMesh.js"),useLoadingCount=__webpack_require__("./node_modules/lingo3d/lib/states/useLoadingCount.js"),bytesLoaded=__webpack_require__("./node_modules/lingo3d/lib/display/utils/loaders/bytesLoaded.js"),useEncoding=__webpack_require__("./node_modules/lingo3d/lib/states/useEncoding.js");const cache=new Map,loadFBX_loader=new FBXLoader_FBXLoader;__webpack_exports__.default=async(url,clone)=>{const group=await Object(lib.e)(cache,url,(()=>new Promise(((resolve,reject)=>{Object(useLoadingCount.c)(),loadFBX_loader.load(url,(group=>{Object(useLoadingCount.a)(),"linear"===Object(useEncoding.a)()?group.traverse((child=>{var _a;(null===(_a=child.material)||void 0===_a?void 0:_a.map)&&(child.material.map.encoding=three_module.vb)})):group.traverse((child=>{var _a;(null===(_a=child.material)||void 0===_a?void 0:_a.map)&&(child.material.map.encoding=three_module.Cd)})),resolve(group)}),bytesLoaded.b,(()=>{Object(useLoadingCount.a)(),reject()}))}))));return clone?Object(cloneSkinnedMesh.a)(group):group}}}]);
//# sourceMappingURL=10.ca930e5a.iframe.bundle.js.map